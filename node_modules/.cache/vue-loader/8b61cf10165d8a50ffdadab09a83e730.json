{"remainingRequest":"/Users/yoon/jz-video/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yoon/jz-video/src/components/vue-cropper/vue-cropper.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yoon/jz-video/src/components/vue-cropper/vue-cropper.vue","mtime":1582719600788},{"path":"/Users/yoon/jz-video/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yoon/jz-video/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yoon/jz-video/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yoon/jz-video/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBleGlmIGZyb20gJ2V4aWYtanMnOwpleHBvcnQgZGVmYXVsdCB7CiAgICBkYXRhOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAvLyDlrrnlmajpq5jlrr0KICAgICAgICAgICAgdzogMCwKICAgICAgICAgICAgaDogMCwKICAgICAgICAgICAgLy8g5Zu+54mH57yp5pS+5q+U5L6LCiAgICAgICAgICAgIHNjYWxlOiAxLAogICAgICAgICAgICAvLyDlm77niYflgY/np7t46L20CiAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgIC8vIOWbvueJh+WBj+enu3novbQKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgLy8g5Zu+54mH5Yqg6L29CiAgICAgICAgICAgIGxvYWRpbmc6IHRydWUsCiAgICAgICAgICAgIC8vIOWbvueJh+ecn+WunuWuveW6pgogICAgICAgICAgICB0cnVlV2lkdGg6IDAsCiAgICAgICAgICAgIC8vIOWbvueJh+ecn+WunumrmOW6pgogICAgICAgICAgICB0cnVlSGVpZ2h0OiAwLAogICAgICAgICAgICBtb3ZlOiB0cnVlLAogICAgICAgICAgICAvLyDnp7vliqjnmoR4CiAgICAgICAgICAgIG1vdmVYOiAwLAogICAgICAgICAgICAvLyDnp7vliqjnmoR5CiAgICAgICAgICAgIG1vdmVZOiAwLAogICAgICAgICAgICAvLyDlvIDlkK/miKrlm74KICAgICAgICAgICAgY3JvcDogZmFsc2UsCiAgICAgICAgICAgIC8vIOato+WcqOaIquWbvgogICAgICAgICAgICBjcm9wcGluZzogZmFsc2UsCiAgICAgICAgICAgIC8vIOijgeWJquahhuWkp+WwjwogICAgICAgICAgICBjcm9wVzogMCwKICAgICAgICAgICAgY3JvcEg6IDAsCiAgICAgICAgICAgIGNyb3BPbGRXOiAwLAogICAgICAgICAgICBjcm9wT2xkSDogMCwKICAgICAgICAgICAgLy8g5Yik5pat5piv5ZCm6IO95aSf5pS55Y+YCiAgICAgICAgICAgIGNhbkNoYW5nZVg6IGZhbHNlLAogICAgICAgICAgICBjYW5DaGFuZ2VZOiBmYWxzZSwKICAgICAgICAgICAgLy8g5pS55Y+Y55qE5Z+65YeG54K5CiAgICAgICAgICAgIGNoYW5nZUNyb3BUeXBlWDogMSwKICAgICAgICAgICAgY2hhbmdlQ3JvcFR5cGVZOiAxLAogICAgICAgICAgICAvLyDoo4HliarmoYbnmoTlnZDmoIfovbQKICAgICAgICAgICAgY3JvcFg6IDAsCiAgICAgICAgICAgIGNyb3BZOiAwLAogICAgICAgICAgICBjcm9wQ2hhbmdlWDogMCwKICAgICAgICAgICAgY3JvcENoYW5nZVk6IDAsCiAgICAgICAgICAgIGNyb3BPZmZzZXJ0WDogMCwKICAgICAgICAgICAgY3JvcE9mZnNlcnRZOiAwLAogICAgICAgICAgICAvLyDmlK/mjIHnmoTmu5rliqjkuovku7YKICAgICAgICAgICAgc3VwcG9ydDogJycsCiAgICAgICAgICAgIC8vIOenu+WKqOerr+aJi+aMh+e8qeaUvgogICAgICAgICAgICB0b3VjaGVzOiBbXSwKICAgICAgICAgICAgdG91Y2hOb3c6IGZhbHNlLAogICAgICAgICAgICAvLyDlm77niYfml4vovawKICAgICAgICAgICAgcm90YXRlOiAwLAogICAgICAgICAgICBpc0lvczogZmFsc2UsCiAgICAgICAgICAgIG9yaWVudGF0aW9uOiAwLAogICAgICAgICAgICBpbWdzOiAnJywKICAgICAgICAgICAgLy8g5Zu+54mH57yp5pS+57O75pWwCiAgICAgICAgICAgIGNvZTogMC4yLAogICAgICAgICAgICAvLyDmmK/lkKbmraPlnKjlpJrmrKHnvKnmlL4KICAgICAgICAgICAgc2NhbGluZzogZmFsc2UsCiAgICAgICAgICAgIHNjYWxpbmdTZXQ6ICcnLAogICAgICAgICAgICBjb2VTdGF0dXM6ICcnCiAgICAgICAgfTsKICAgIH0sCiAgICBwcm9wczogewogICAgICAgIGltZzogewogICAgICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgICAgIGRlZmF1bHQ6ICcnCiAgICAgICAgfSwKICAgICAgICAvLyDovpPlh7rlm77niYfljovnvKnmr5QKICAgICAgICBvdXRwdXRTaXplOiB7CiAgICAgICAgICAgIHR5cGU6IE51bWJlciwKICAgICAgICAgICAgZGVmYXVsdDogMQogICAgICAgIH0sCiAgICAgICAgb3V0cHV0VHlwZTogewogICAgICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgICAgIGRlZmF1bHQ6ICdqcGVnJwogICAgICAgIH0sCiAgICAgICAgaW5mbzogewogICAgICAgICAgICB0eXBlOiBCb29sZWFuLAogICAgICAgICAgICBkZWZhdWx0OiB0cnVlCiAgICAgICAgfSwKICAgICAgICAvLyDmmK/lkKblvIDlkK/mu5rova7mlL7lpKfnvKnlsI8KICAgICAgICBjYW5TY2FsZTogewogICAgICAgICAgICB0eXBlOiBCb29sZWFuLAogICAgICAgICAgICBkZWZhdWx0OiB0cnVlCiAgICAgICAgfSwKICAgICAgICAvLyDmmK/lkKboh6rmiJDmiKrlm77moYYKICAgICAgICBhdXRvQ3JvcDogewogICAgICAgICAgICB0eXBlOiBCb29sZWFuLAogICAgICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIH0sCiAgICAgICAgYXV0b0Nyb3BXaWR0aDogewogICAgICAgICAgICB0eXBlOiBOdW1iZXIsCiAgICAgICAgICAgIGRlZmF1bHQ6IDAKICAgICAgICB9LAogICAgICAgIGF1dG9Dcm9wSGVpZ2h0OiB7CiAgICAgICAgICAgIHR5cGU6IE51bWJlciwKICAgICAgICAgICAgZGVmYXVsdDogMAogICAgICAgIH0sCiAgICAgICAgLy8g5piv5ZCm5byA5ZCv5Zu65a6a5a696auY5q+UCiAgICAgICAgZml4ZWQ6IHsKICAgICAgICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICB9LAogICAgICAgIC8vIOWuvemrmOavlCB3L2gKICAgICAgICBmaXhlZE51bWJlcjogewogICAgICAgICAgICB0eXBlOiBBcnJheSwKICAgICAgICAgICAgZGVmYXVsdDogKCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIFsxLCAxXTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLy8g5Zu65a6a5aSn5bCPIOemgeatouaUueWPmOaIquWbvuahhuWkp+WwjwogICAgICAgIGZpeGVkQm94OiB7CiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgICAgfSwKICAgICAgICAvLyDovpPlh7rmiKrlm77mmK/lkKbnvKnmlL4KICAgICAgICBmdWxsOiB7CiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgICAgfSwKICAgICAgICAvLyDmmK/lkKblj6/ku6Xmi5bliqjlm77niYcKICAgICAgICBjYW5Nb3ZlOiB7CiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgICAgICAgIGRlZmF1bHQ6IHRydWUKICAgICAgICB9LAogICAgICAgIC8vIOaYr+WQpuWPr+S7peaLluWKqOaIquWbvuahhgogICAgICAgIGNhbk1vdmVCb3g6IHsKICAgICAgICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgICAgICAgZGVmYXVsdDogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgLy8g5LiK5Lyg5Zu+54mH5oyJ54Wn5Y6f5aeL5q+U5L6L5pi+56S6CiAgICAgICAgb3JpZ2luYWw6IHsKICAgICAgICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICB9CiAgICB9LAogICAgY29tcHV0ZWQ6IHsKICAgICAgICBjcm9wSW5mbygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JvcE9mZnNlcnRZID4gMjAgPyAnLTIwcHgnIDogJzBweCc7CiAgICAgICAgfQogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgLy8g5aaC5p6c5Zu+54mH5pS55Y+Y77yMIOmHjeaWsOW4g+WxgAogICAgICAgIGltZygpIHsKICAgICAgICAgICAgLy8g5b2T5Lyg5YWl5Zu+54mH5pe2LCDor7vlj5blm77niYfkv6Hmga/lkIzml7blsZXnpLoKICAgICAgICAgICAgdGhpcy5jaGVja2VkSW1nKCk7CiAgICAgICAgfSwKICAgICAgICBpbWdzKHZhbCkgewogICAgICAgICAgICBpZiAodmFsID09PSAnJykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucmVsb2FkKCk7CiAgICAgICAgfSwKICAgICAgICBjcm9wVygpIHsKICAgICAgICAgICAgdGhpcy5jcm9wVyA9IH5+dGhpcy5jcm9wVzsKICAgICAgICAgICAgdGhpcy5zaG93UHJldmlldygpOwogICAgICAgIH0sCiAgICAgICAgY3JvcEgoKSB7CiAgICAgICAgICAgIHRoaXMuY3JvcEggPSB+fnRoaXMuY3JvcEg7CiAgICAgICAgICAgIHRoaXMuc2hvd1ByZXZpZXcoKTsKICAgICAgICB9LAogICAgICAgIGNyb3BPZmZzZXJ0WCgpIHsKICAgICAgICAgICAgdGhpcy5zaG93UHJldmlldygpOwogICAgICAgIH0sCiAgICAgICAgY3JvcE9mZnNlcnRZKCkgewogICAgICAgICAgICB0aGlzLnNob3dQcmV2aWV3KCk7CiAgICAgICAgfSwKICAgICAgICBzY2FsZSgpIHsKICAgICAgICAgICAgdGhpcy5zaG93UHJldmlldygpOwogICAgICAgIH0sCiAgICAgICAgeCgpIHsKICAgICAgICAgICAgdGhpcy5zaG93UHJldmlldygpOwogICAgICAgIH0sCiAgICAgICAgeSgpIHsKICAgICAgICAgICAgdGhpcy5zaG93UHJldmlldygpOwogICAgICAgIH0sCiAgICAgICAgcm90YXRlKCkgewogICAgICAgICAgICB0aGlzLnNob3dQcmV2aWV3KCk7CiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICAvLyDmoKHpqozlm77niYcKICAgICAgICBjaGVja2VkSW1nKCkgewogICAgICAgICAgICBpZiAodGhpcy5pbWcgPT09ICcnKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuc2NhbGUgPSAxOwogICAgICAgICAgICB0aGlzLmNsZWFyQ3JvcCgpOwogICAgICAgICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgICAgICAgbGV0IHJvdGF0ZSA9IDA7CiAgICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgd2lkdGggPSBpbWcud2lkdGg7CiAgICAgICAgICAgICAgICBsZXQgaGVpZ2h0ID0gaW1nLmhlaWdodDsKICAgICAgICAgICAgICAgIGxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBleGlmLmdldERhdGEoaW1nLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZXhpZi5nZXRBbGxUYWdzKGltZyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmllbnRhdGlvbiA9IGV4aWYuZ2V0VGFnKGltZywgJ09yaWVudGF0aW9uJyk7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLm9yaWVudGF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0ZSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRlID0gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRlID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRlID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdGF0ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmltZ3MgPSB0aGlzLmltZzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJvdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIC0zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5peL6L2sOTDluqYg5oiW6ICFLTI3MOW6piDlrr3luqblkozpq5jluqblr7nosIMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB3aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocm90YXRlICogOTAgKiBNYXRoLlBJIC8gMTgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAtaGVpZ2h0LCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgLTI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0ZSAqIDkwICogTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgLXdpZHRoLCAtaGVpZ2h0LCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgLTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gd2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0ZSAqIDkwICogTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgLXdpZHRoLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgICAgIGNhbnZhcy50b0Jsb2IoCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWdzID0gZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ltYWdlLycgKyB0aGlzLm91dHB1dFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIDEKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGltZy5vbmVycm9yID0gKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnaW1nTG9hZCcsICdlcnJvcicpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAnKic7CiAgICAgICAgICAgIGltZy5zcmMgPSB0aGlzLmltZzsKICAgICAgICB9LAogICAgICAgIC8vIOW9k+aMieS4i+m8oOagh+mUrgogICAgICAgIHN0YXJ0TW92ZShlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgLy8g5aaC5p6cbW92ZSDkuLp0cnVlIOihqOekuuW9k+WJjeWPr+S7peaLluWKqAogICAgICAgICAgICBpZiAodGhpcy5tb3ZlICYmICF0aGlzLmNyb3ApIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5jYW5Nb3ZlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8g5byA5aeL56e75YqoCiAgICAgICAgICAgICAgICB0aGlzLm1vdmVYID0KICAgICAgICAgICAgICAgICAgICAoZS5jbGllbnRYID8gZS5jbGllbnRYIDogZS50b3VjaGVzWzBdLmNsaWVudFgpIC0gdGhpcy54OwogICAgICAgICAgICAgICAgdGhpcy5tb3ZlWSA9CiAgICAgICAgICAgICAgICAgICAgKGUuY2xpZW50WSA/IGUuY2xpZW50WSA6IGUudG91Y2hlc1swXS5jbGllbnRZKSAtIHRoaXMueTsKICAgICAgICAgICAgICAgIGlmIChlLnRvdWNoZXMpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5tb3ZlSW1nKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLmxlYXZlSW1nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOiusOW9leaJi+aMh+WImuWImuaUvuS4iuWOuwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdWNoZXMgPSBlLnRvdWNoZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLnRvdWNoU2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3VjaGVuZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbmNsZVRvdWNoU2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm1vdmVJbWcpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5sZWF2ZUltZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDmiKrlm75pbmcKICAgICAgICAgICAgICAgIHRoaXMuY3JvcHBpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgLy8g57uR5a6a5oiq5Zu+5LqL5Lu2CiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5jcmVhdGVDcm9wKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5lbmRDcm9wKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLmNyZWF0ZUNyb3ApOwogICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5lbmRDcm9wKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRYID0gZS5vZmZzZXRYID8KICAgICAgICAgICAgICAgICAgICBlLm9mZnNldFggOgogICAgICAgICAgICAgICAgICAgIGUudG91Y2hlc1swXS5wYWdlWCAtIHRoaXMuJHJlZnMuY3JvcHBlci5vZmZzZXRMZWZ0OwogICAgICAgICAgICAgICAgdGhpcy5jcm9wT2Zmc2VydFkgPSBlLm9mZnNldFkgPwogICAgICAgICAgICAgICAgICAgIGUub2Zmc2V0WSA6CiAgICAgICAgICAgICAgICAgICAgZS50b3VjaGVzWzBdLnBhZ2VZIC0gdGhpcy4kcmVmcy5jcm9wcGVyLm9mZnNldFRvcDsKICAgICAgICAgICAgICAgIHRoaXMuY3JvcFggPSBlLmNsaWVudFggPyBlLmNsaWVudFggOiBlLnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICAgICAgICAgIHRoaXMuY3JvcFkgPSBlLmNsaWVudFkgPyBlLmNsaWVudFkgOiBlLnRvdWNoZXNbMF0uY2xpZW50WTsKICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVggPSB0aGlzLmNyb3BPZmZzZXJ0WDsKICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVkgPSB0aGlzLmNyb3BPZmZzZXJ0WTsKICAgICAgICAgICAgICAgIHRoaXMuY3JvcFcgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5jcm9wSCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvLyDnp7vliqjnq6/nvKnmlL4KICAgICAgICB0b3VjaFNjYWxlKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAvLyDorrDlvZXlj5jljJbph48KICAgICAgICAgICAgLy8g56ys5LiA5qC55omL5oyHCiAgICAgICAgICAgIHZhciBvbGRUb3VjaDEgPSB7CiAgICAgICAgICAgICAgICB4OiB0aGlzLnRvdWNoZXNbMF0uY2xpZW50WCwKICAgICAgICAgICAgICAgIHk6IHRoaXMudG91Y2hlc1swXS5jbGllbnRZCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBuZXdUb3VjaDEgPSB7CiAgICAgICAgICAgICAgICB4OiBlLnRvdWNoZXNbMF0uY2xpZW50WCwKICAgICAgICAgICAgICAgIHk6IGUudG91Y2hlc1swXS5jbGllbnRZCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIC8vIOesrOS6jOagueaJi+aMhwogICAgICAgICAgICB2YXIgb2xkVG91Y2gyID0gewogICAgICAgICAgICAgICAgeDogdGhpcy50b3VjaGVzWzFdLmNsaWVudFgsCiAgICAgICAgICAgICAgICB5OiB0aGlzLnRvdWNoZXNbMV0uY2xpZW50WQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgbmV3VG91Y2gyID0gewogICAgICAgICAgICAgICAgeDogZS50b3VjaGVzWzFdLmNsaWVudFgsCiAgICAgICAgICAgICAgICB5OiBlLnRvdWNoZXNbMV0uY2xpZW50WQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgb2xkTCA9IE1hdGguc3FydCgKICAgICAgICAgICAgICAgIE1hdGgucG93KG9sZFRvdWNoMS54IC0gb2xkVG91Y2gyLngsIDIpICsKICAgICAgICAgICAgICAgIE1hdGgucG93KG9sZFRvdWNoMS55IC0gb2xkVG91Y2gyLnksIDIpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHZhciBuZXdMID0gTWF0aC5zcXJ0KAogICAgICAgICAgICAgICAgTWF0aC5wb3cobmV3VG91Y2gxLnggLSBuZXdUb3VjaDIueCwgMikgKwogICAgICAgICAgICAgICAgTWF0aC5wb3cobmV3VG91Y2gxLnkgLSBuZXdUb3VjaDIueSwgMikKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdmFyIGNoYSA9IH5+KG5ld0wgLSBvbGRMKTsKICAgICAgICAgICAgLy8g5qC55o2u5Zu+54mH5pys6Lqr5aSn5bCPIOWGs+Wumuavj+asoeaUueWPmOWkp+Wwj+eahOezu+aVsCwg5Zu+54mH6LaK5aSn57O75pWw6LaK5bCPCiAgICAgICAgICAgIC8vIDFweCAtIDAuMgogICAgICAgICAgICB2YXIgY29lID0gMTsKICAgICAgICAgICAgY29lID0KICAgICAgICAgICAgICAgIGNvZSAvIHRoaXMudHJ1ZVdpZHRoID4gY29lIC8gdGhpcy50cnVlSGVpZ2h0ID8KICAgICAgICAgICAgICAgIGNvZSAvIHRoaXMudHJ1ZUhlaWdodCA6CiAgICAgICAgICAgICAgICBjb2UgLyB0aGlzLnRydWVXaWR0aDsKICAgICAgICAgICAgY29lID0gY29lID4gMC4xID8gMC4xIDogY29lOwogICAgICAgICAgICB2YXIgbnVtID0gY29lICogY2hhOwogICAgICAgICAgICBpZiAoIXRoaXMudG91Y2hOb3cpIHsKICAgICAgICAgICAgICAgIHRoaXMudG91Y2hOb3cgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKGNoYSA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlICs9IE1hdGguYWJzKG51bSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYSA8IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlID4gTWF0aC5hYnMobnVtKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnNjYWxlIC09IE1hdGguYWJzKG51bSkpIDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudG91Y2hlcyA9IGUudG91Y2hlczsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hOb3cgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0sIDgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgY2FuY2xlVG91Y2hTY2FsZShlKSB7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLnRvdWNoU2NhbGUpOwogICAgICAgIH0sCgogICAgICAgIC8vIOenu+WKqOWbvueJhwogICAgICAgIG1vdmVJbWcoZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChlLnRvdWNoZXMgJiYgZS50b3VjaGVzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgdGhpcy50b3VjaGVzID0gZS50b3VjaGVzOwogICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMudG91Y2hTY2FsZSk7CiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLmNhbmNsZVRvdWNoU2NhbGUpOwogICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMubW92ZUltZyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG5vd1ggPSBlLmNsaWVudFggPyBlLmNsaWVudFggOiBlLnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICAgICAgdmFyIG5vd1kgPSBlLmNsaWVudFkgPyBlLmNsaWVudFkgOiBlLnRvdWNoZXNbMF0uY2xpZW50WTsKICAgICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy54ID0gfn4obm93WCAtIHRoaXMubW92ZVgpOwogICAgICAgICAgICAgICAgdGhpcy55ID0gfn4obm93WSAtIHRoaXMubW92ZVkpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIC8vIOenu+WKqOWbvueJh+e7k+adnwogICAgICAgIGxlYXZlSW1nKGUpIHsKICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMubW92ZUltZyk7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLm1vdmVJbWcpOwogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMubGVhdmVJbWcpOwogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLmxlYXZlSW1nKTsKICAgICAgICB9LAogICAgICAgIC8vIOe8qeaUvuWbvueJhwogICAgICAgIHNjYWxlSW1nKCkgewogICAgICAgICAgICB0aGlzLnN1cHBvcnQgPQogICAgICAgICAgICAgICAgJ29ud2hlZWwnIGluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpID8KICAgICAgICAgICAgICAgICd3aGVlbCcgOgogICAgICAgICAgICAgICAgZG9jdW1lbnQub25tb3VzZXdoZWVsICE9PSB1bmRlZmluZWQgPwogICAgICAgICAgICAgICAgJ21vdXNld2hlZWwnIDoKICAgICAgICAgICAgICAgICdET01Nb3VzZVNjcm9sbCc7CiAgICAgICAgICAgIGlmICh0aGlzLmNhblNjYWxlKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLnN1cHBvcnQsIHRoaXMuY2hhbmdlU2l6ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vIOenu+WHuuahhgogICAgICAgIGNhbmNsZVNjYWxlKCkgewogICAgICAgICAgICBpZiAodGhpcy5jYW5TY2FsZSkgewogICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5zdXBwb3J0LCB0aGlzLmNoYW5nZVNpemUpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyDmlLnlj5jlpKflsI/lh73mlbAKICAgICAgICBjaGFuZ2VTaXplKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgY2hhbmdlID0gZS5kZWx0YVkgfHwgZS53aGVlbERlbHRhOwogICAgICAgICAgICAvLyDmoLnmja7lm77niYfmnKzouqvlpKflsI8g5Yaz5a6a5q+P5qyh5pS55Y+Y5aSn5bCP55qE57O75pWwLCDlm77niYfotorlpKfns7vmlbDotorlsI8KICAgICAgICAgICAgdmFyIGlzRmlyZWZveCA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignRmlyZWZveCcpOwogICAgICAgICAgICBjaGFuZ2UgPSBpc0ZpcmVmb3ggPiAwID8gY2hhbmdlICogMzAgOiBjaGFuZ2U7CiAgICAgICAgICAgIC8vIDFweCAtIDAuMgogICAgICAgICAgICB2YXIgY29lID0gdGhpcy5jb2U7CiAgICAgICAgICAgIGNvZSA9CiAgICAgICAgICAgICAgICBjb2UgLyB0aGlzLnRydWVXaWR0aCA+IGNvZSAvIHRoaXMudHJ1ZUhlaWdodCA/CiAgICAgICAgICAgICAgICBjb2UgLyB0aGlzLnRydWVIZWlnaHQgOgogICAgICAgICAgICAgICAgY29lIC8gdGhpcy50cnVlV2lkdGg7CiAgICAgICAgICAgIHZhciBudW0gPSBjb2UgKiBjaGFuZ2U7CiAgICAgICAgICAgIG51bSA8IDAgPwogICAgICAgICAgICAgICAgKHRoaXMuc2NhbGUgKz0gTWF0aC5hYnMobnVtKSkgOgogICAgICAgICAgICAgICAgdGhpcy5zY2FsZSA+IE1hdGguYWJzKG51bSkgPwogICAgICAgICAgICAgICAgKHRoaXMuc2NhbGUgLT0gTWF0aC5hYnMobnVtKSkgOgogICAgICAgICAgICAgICAgdGhpcy5zY2FsZTsKICAgICAgICAgICAgLy8g5bu26L+fMC4xcyDmr4/mrKHmlL7lpKflpKfmiJbogIXnvKnlsI/nmoTojIPlm7QKICAgICAgICAgICAgbGV0IHN0YXR1cyA9IG51bSA8IDAgPyAnYWRkJyA6ICdyZWR1Y2UnOwogICAgICAgICAgICBpZiAoc3RhdHVzICE9PSB0aGlzLmNvZVN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5jb2VTdGF0dXMgPSBzdGF0dXM7CiAgICAgICAgICAgICAgICB0aGlzLmNvZSA9IDAuMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMuc2NhbGluZykgewogICAgICAgICAgICAgICAgdGhpcy5zY2FsaW5nU2V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2UgPSB0aGlzLmNvZSArPSAwLjAxOwogICAgICAgICAgICAgICAgfSwgNTApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2NhbGluZyA9IHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgLy8g5L+u5pS55Zu+54mH5aSn5bCP5Ye95pWwCiAgICAgICAgY2hhbmdlU2NhbGUobnVtKSB7CiAgICAgICAgICAgIG51bSA9IG51bSB8fCAxOwogICAgICAgICAgICB2YXIgY29lID0gMjA7CiAgICAgICAgICAgIGNvZSA9CiAgICAgICAgICAgICAgICBjb2UgLyB0aGlzLnRydWVXaWR0aCA+IGNvZSAvIHRoaXMudHJ1ZUhlaWdodCA/CiAgICAgICAgICAgICAgICBjb2UgLyB0aGlzLnRydWVIZWlnaHQgOgogICAgICAgICAgICAgICAgY29lIC8gdGhpcy50cnVlV2lkdGg7CiAgICAgICAgICAgIG51bSA9IG51bSAqIGNvZTsKICAgICAgICAgICAgbnVtID4gMCA/CiAgICAgICAgICAgICAgICAodGhpcy5zY2FsZSArPSBNYXRoLmFicyhudW0pKSA6CiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlID4gTWF0aC5hYnMobnVtKSA/CiAgICAgICAgICAgICAgICAodGhpcy5zY2FsZSAtPSBNYXRoLmFicyhudW0pKSA6CiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlOwogICAgICAgIH0sCiAgICAgICAgLy8g5Yib5bu65oiq5Zu+5qGGCiAgICAgICAgY3JlYXRlQ3JvcChlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgLy8g56e75Yqo55Sf5oiQ5aSn5bCPCiAgICAgICAgICAgIHZhciBub3dYID0gZS5jbGllbnRYID8KICAgICAgICAgICAgICAgIGUuY2xpZW50WCA6CiAgICAgICAgICAgICAgICBlLnRvdWNoZXMgPyBlLnRvdWNoZXNbMF0uY2xpZW50WCA6IDA7CiAgICAgICAgICAgIHZhciBub3dZID0gZS5jbGllbnRZID8KICAgICAgICAgICAgICAgIGUuY2xpZW50WSA6CiAgICAgICAgICAgICAgICBlLnRvdWNoZXMgPyBlLnRvdWNoZXNbMF0uY2xpZW50WSA6IDA7CiAgICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgICAgICAgIHZhciBmdyA9IH5+KG5vd1ggLSB0aGlzLmNyb3BYKTsKICAgICAgICAgICAgICAgIHZhciBmaCA9IH5+KG5vd1kgLSB0aGlzLmNyb3BZKTsKICAgICAgICAgICAgICAgIGlmIChmdyA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BXID0KICAgICAgICAgICAgICAgICAgICAgICAgZncgKyB0aGlzLmNyb3BDaGFuZ2VYID4gdGhpcy53ID8KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53IC0gdGhpcy5jcm9wQ2hhbmdlWCA6CiAgICAgICAgICAgICAgICAgICAgICAgIGZ3OwogICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRYID0gdGhpcy5jcm9wQ2hhbmdlWDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wVyA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyAtIHRoaXMuY3JvcENoYW5nZVggKyBNYXRoLmFicyhmdykgPiB0aGlzLncgPwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BDaGFuZ2VYIDoKICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZncpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRYID0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wQ2hhbmdlWCArIGZ3ID4gMCA/IHRoaXMuY3JvcENoYW5nZVggKyBmdyA6IDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpeGVkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BIID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZoICsgdGhpcy5jcm9wQ2hhbmdlWSA+IHRoaXMuaCA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmggLSB0aGlzLmNyb3BDaGFuZ2VZIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZoOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WSA9IHRoaXMuY3JvcENoYW5nZVk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wSCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmggLSB0aGlzLmNyb3BDaGFuZ2VZICsgTWF0aC5hYnMoZmgpID4gdGhpcy5oID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BDaGFuZ2VZICsgZmggPiAwID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVkgKyBmaCA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpeGVkSGVpZ2h0ID0gfn4oCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcFcgLwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpeGVkTnVtYmVyWzBdICoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXhlZE51bWJlclsxXQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpeGVkSGVpZ2h0ICsgdGhpcy5jcm9wT2Zmc2VydFkgPiB0aGlzLmgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wSCA9IHRoaXMuaCAtIHRoaXMuY3JvcE9mZnNlcnRZOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BXID0gfn4oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BIIC8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZml4ZWROdW1iZXJbMV0gKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXhlZE51bWJlclswXQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZncgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WCA9IHRoaXMuY3JvcENoYW5nZVg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WCA9IHRoaXMuY3JvcENoYW5nZVggLSB0aGlzLmNyb3BXOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wSCA9IGZpeGVkSGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WSA9IHRoaXMuY3JvcE9mZnNlcnRZOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICAvLyDmlLnlj5jmiKrlm77moYblpKflsI8KICAgICAgICBjaGFuZ2VDcm9wU2l6ZShlLCB3LCBoLCB0eXBlVywgdHlwZUgpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5jaGFuZ2VDcm9wTm93KTsKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLmNoYW5nZUNyb3BFbmQpOwogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5jaGFuZ2VDcm9wTm93KTsKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5jaGFuZ2VDcm9wRW5kKTsKICAgICAgICAgICAgdGhpcy5jYW5DaGFuZ2VYID0gdzsKICAgICAgICAgICAgdGhpcy5jYW5DaGFuZ2VZID0gaDsKICAgICAgICAgICAgdGhpcy5jaGFuZ2VDcm9wVHlwZVggPSB0eXBlVzsKICAgICAgICAgICAgdGhpcy5jaGFuZ2VDcm9wVHlwZVkgPSB0eXBlSDsKICAgICAgICAgICAgdGhpcy5jcm9wWCA9IGUuY2xpZW50WCA/IGUuY2xpZW50WCA6IGUudG91Y2hlc1swXS5jbGllbnRYOwogICAgICAgICAgICB0aGlzLmNyb3BZID0gZS5jbGllbnRZID8gZS5jbGllbnRZIDogZS50b3VjaGVzWzBdLmNsaWVudFk7CiAgICAgICAgICAgIHRoaXMuY3JvcE9sZFcgPSB0aGlzLmNyb3BXOwogICAgICAgICAgICB0aGlzLmNyb3BPbGRIID0gdGhpcy5jcm9wSDsKICAgICAgICAgICAgdGhpcy5jcm9wQ2hhbmdlWCA9IHRoaXMuY3JvcE9mZnNlcnRYOwogICAgICAgICAgICB0aGlzLmNyb3BDaGFuZ2VZID0gdGhpcy5jcm9wT2Zmc2VydFk7CiAgICAgICAgICAgIGlmICh0aGlzLmZpeGVkKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW5DaGFuZ2VYICYmIHRoaXMuY2FuQ2hhbmdlWSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuQ2hhbmdlWSA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvLyDmraPlnKjmlLnlj5gKICAgICAgICBjaGFuZ2VDcm9wTm93KGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgbm93WCA9IGUuY2xpZW50WCA/CiAgICAgICAgICAgICAgICBlLmNsaWVudFggOgogICAgICAgICAgICAgICAgZS50b3VjaGVzID8gZS50b3VjaGVzWzBdLmNsaWVudFggOiAwOwogICAgICAgICAgICB2YXIgbm93WSA9IGUuY2xpZW50WSA/CiAgICAgICAgICAgICAgICBlLmNsaWVudFkgOgogICAgICAgICAgICAgICAgZS50b3VjaGVzID8gZS50b3VjaGVzWzBdLmNsaWVudFkgOiAwOwogICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgZncgPSB+fihub3dYIC0gdGhpcy5jcm9wWCk7CiAgICAgICAgICAgICAgICB2YXIgZmggPSB+fihub3dZIC0gdGhpcy5jcm9wWSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW5DaGFuZ2VYKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhbmdlQ3JvcFR5cGVYID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNyb3BPbGRXIC0gZncgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BXID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLncgLSB0aGlzLmNyb3BDaGFuZ2VYIC0gZncgPD0gdGhpcy53ID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPbGRXIC0gZncgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9sZFcgKyB0aGlzLmNyb3BDaGFuZ2VYOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wT2Zmc2VydFggPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyAtIHRoaXMuY3JvcENoYW5nZVggLSBmdyA8PSB0aGlzLncgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVggKyBmdyA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcFcgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGZ3KSArIHRoaXMuY3JvcENoYW5nZVggPD0gdGhpcy53ID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyhmdykgLSB0aGlzLmNyb3BPbGRXIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLncgLSB0aGlzLmNyb3BPbGRXIC0gdGhpcy5jcm9wQ2hhbmdlWDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRYID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BDaGFuZ2VYICsgdGhpcy5jcm9wT2xkVzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGFuZ2VDcm9wVHlwZVggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY3JvcE9sZFcgKyBmdyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcFcgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9sZFcgKyBmdyArIHRoaXMuY3JvcE9mZnNlcnRYIDw9IHRoaXMudyA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wT2xkVyArIGZ3IDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLncgLSB0aGlzLmNyb3BPZmZzZXJ0WDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRYID0gdGhpcy5jcm9wQ2hhbmdlWDsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcFcgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyAtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wQ2hhbmdlWCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZncgKyB0aGlzLmNyb3BPbGRXKSA8PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZncgKyB0aGlzLmNyb3BPbGRXKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wQ2hhbmdlWDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRYID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLncgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVggKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGZ3ICsgdGhpcy5jcm9wT2xkVykgPD0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLncgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVggLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGZ3ICsgdGhpcy5jcm9wT2xkVykgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FuQ2hhbmdlWSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYW5nZUNyb3BUeXBlWSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jcm9wT2xkSCAtIGZoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wSCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oIC0gdGhpcy5jcm9wQ2hhbmdlWSAtIGZoIDw9IHRoaXMuaCA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wT2xkSCAtIGZoIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPbGRIICsgdGhpcy5jcm9wQ2hhbmdlWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRZID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmggLSB0aGlzLmNyb3BDaGFuZ2VZIC0gZmggPD0gdGhpcy5oID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BDaGFuZ2VZICsgZmggOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BIID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyhmaCkgKyB0aGlzLmNyb3BDaGFuZ2VZIDw9IHRoaXMuaCA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmgpIC0gdGhpcy5jcm9wT2xkSCA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oIC0gdGhpcy5jcm9wT2xkSCAtIHRoaXMuY3JvcENoYW5nZVk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wQ2hhbmdlWSArIHRoaXMuY3JvcE9sZEg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hhbmdlQ3JvcFR5cGVZID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNyb3BPbGRIICsgZmggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BIID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPbGRIICsgZmggKyB0aGlzLmNyb3BPZmZzZXJ0WSA8PSB0aGlzLmggPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9sZEggKyBmaCA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oIC0gdGhpcy5jcm9wT2Zmc2VydFk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WSA9IHRoaXMuY3JvcENoYW5nZVk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BIID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmggLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGZoICsgdGhpcy5jcm9wT2xkSCkgPD0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmggPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGZoICsgdGhpcy5jcm9wT2xkSCkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcENoYW5nZVk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BDaGFuZ2VZICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyhmaCArIHRoaXMuY3JvcE9sZEgpIDw9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BDaGFuZ2VZIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyhmaCArIHRoaXMuY3JvcE9sZEgpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbkNoYW5nZVggJiYgdGhpcy5maXhlZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBmaXhlZEhlaWdodCA9IH5+KAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BXIC8KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXhlZE51bWJlclswXSAqCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZml4ZWROdW1iZXJbMV0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGlmIChmaXhlZEhlaWdodCArIHRoaXMuY3JvcE9mZnNlcnRZID4gdGhpcy5oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcEggPSB0aGlzLmggLSB0aGlzLmNyb3BPZmZzZXJ0WTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wVyA9IH5+KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wSCAvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpeGVkTnVtYmVyWzFdICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZml4ZWROdW1iZXJbMF0KICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BIID0gZml4ZWRIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbkNoYW5nZVkgJiYgdGhpcy5maXhlZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBmaXhlZFdpZHRoID0gfn4oCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcEggLwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpeGVkTnVtYmVyWzFdICoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXhlZE51bWJlclswXQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpeGVkV2lkdGggKyB0aGlzLmNyb3BPZmZzZXJ0WCA+IHRoaXMudykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3BXID0gdGhpcy53IC0gdGhpcy5jcm9wT2Zmc2VydFg7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcEggPSB+figKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcFcgLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXhlZE51bWJlclswXSAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpeGVkTnVtYmVyWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wVyA9IGZpeGVkV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICAvLyDnu5PmnZ/mlLnlj5gKICAgICAgICBjaGFuZ2VDcm9wRW5kKGUpIHsKICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuY2hhbmdlQ3JvcE5vdyk7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5jaGFuZ2VDcm9wRW5kKTsKICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMuY2hhbmdlQ3JvcE5vdyk7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMuY2hhbmdlQ3JvcEVuZCk7CiAgICAgICAgfSwKCiAgICAgICAgLy8g5Yib5bu65a6M5oiQCiAgICAgICAgZW5kQ3JvcCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuY3JvcFcgPT09IDAgJiYgdGhpcy5jcm9wSCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5jcm9wcGluZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLmNyZWF0ZUNyb3ApOwogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuZW5kQ3JvcCk7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLmNyZWF0ZUNyb3ApOwogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLmVuZENyb3ApOwogICAgICAgIH0sCiAgICAgICAgLy8g5byA5aeL5oiq5Zu+CiAgICAgICAgc3RhcnRDcm9wKCkgewogICAgICAgICAgICB0aGlzLmNyb3AgPSB0cnVlOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygn5byA5aeL5oiq5Zu+JykKICAgICAgICB9LAogICAgICAgIC8vIOWBnOatouaIquWbvgogICAgICAgIHN0b3BDcm9wKCkgewogICAgICAgICAgICB0aGlzLmNyb3AgPSBmYWxzZTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ+WBnOatouaIquWbvicpCiAgICAgICAgfSwKICAgICAgICAvLyDmuIXpmaTmiKrlm74KICAgICAgICBjbGVhckNyb3AoKSB7CiAgICAgICAgICAgIHRoaXMuY3JvcHBpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jcm9wVyA9IDA7CiAgICAgICAgICAgIHRoaXMuY3JvcEggPSAwOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygn5riF6Zmk5oiq5Zu+JykKICAgICAgICB9LAogICAgICAgIC8vIOaIquWbvuenu+WKqAogICAgICAgIGNyb3BNb3ZlKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBpZiAoIXRoaXMuY2FuTW92ZUJveCkgewogICAgICAgICAgICAgICAgdGhpcy5jcm9wID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0TW92ZShlKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5tb3ZlQ3JvcCk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5sZWF2ZUNyb3ApOwogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5tb3ZlQ3JvcCk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMubGVhdmVDcm9wKTsKICAgICAgICAgICAgdGhpcy5jcm9wWCA9CiAgICAgICAgICAgICAgICAoZS5jbGllbnRYID8gZS5jbGllbnRYIDogZS50b3VjaGVzWzBdLmNsaWVudFgpIC0KICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRYOwogICAgICAgICAgICB0aGlzLmNyb3BZID0KICAgICAgICAgICAgICAgIChlLmNsaWVudFkgPyBlLmNsaWVudFkgOiBlLnRvdWNoZXNbMF0uY2xpZW50WSkgLQogICAgICAgICAgICAgICAgdGhpcy5jcm9wT2Zmc2VydFk7CiAgICAgICAgfSwKCiAgICAgICAgbW92ZUNyb3AoZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBub3dYID0gZS5jbGllbnRYID8gZS5jbGllbnRYIDogZS50b3VjaGVzWzBdLmNsaWVudFg7CiAgICAgICAgICAgIHZhciBub3dZID0gZS5jbGllbnRZID8gZS5jbGllbnRZIDogZS50b3VjaGVzWzBdLmNsaWVudFk7CiAgICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgICAgICAgIHZhciBmdyA9IH5+KG5vd1ggLSB0aGlzLmNyb3BYKTsKICAgICAgICAgICAgICAgIHZhciBmaCA9IH5+KG5vd1kgLSB0aGlzLmNyb3BZKTsKICAgICAgICAgICAgICAgIGlmIChmdyA8PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wT2Zmc2VydFggPSAxOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh+fihmdyArIHRoaXMuY3JvcFcpID4gdGhpcy53KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wT2Zmc2VydFggPSB0aGlzLncgLSB0aGlzLmNyb3BXIC0gMTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9wT2Zmc2VydFggPSBmdzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZmggPD0gMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRZID0gMTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAofn4oZmggKyB0aGlzLmNyb3BIKSA+IHRoaXMuaCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRZID0gdGhpcy5oIC0gdGhpcy5jcm9wSCAtIDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY3JvcE9mZnNlcnRZID0gZmg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIGxlYXZlQ3JvcChlKSB7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm1vdmVDcm9wKTsKICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLmxlYXZlQ3JvcCk7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLm1vdmVDcm9wKTsKICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5sZWF2ZUNyb3ApOwogICAgICAgIH0sCiAgICAgICAgLy8g6I635Y+W6L2s5o2i5oiQYmFzZTY0IOeahOWbvueJh+S/oeaBrwogICAgICAgIGdldENyb3BEYXRhKGNiKSB7CiAgICAgICAgICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICAgICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgICAgICBsZXQgcm90YXRlID0gdGhpcy5yb3RhdGU7CiAgICAgICAgICAgIGxldCB0cnVlV2lkdGggPSB0aGlzLnRydWVXaWR0aDsKICAgICAgICAgICAgbGV0IHRydWVIZWlnaHQgPSB0aGlzLnRydWVIZWlnaHQ7CiAgICAgICAgICAgIGxldCBjcm9wT2Zmc2VydFggPSB0aGlzLmNyb3BPZmZzZXJ0WDsKICAgICAgICAgICAgbGV0IGNyb3BPZmZzZXJ0WSA9IHRoaXMuY3JvcE9mZnNlcnRZOwogICAgICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKH5+dGhpcy5jcm9wVyAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgICAgICBsZXQgd2lkdGggPSB0aGlzLmNyb3BXOwogICAgICAgICAgICAgICAgICAgIGxldCBoZWlnaHQgPSB0aGlzLmNyb3BIOwogICAgICAgICAgICAgICAgICAgIGxldCBpbWdXID0gdHJ1ZVdpZHRoICogdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgICAgICBsZXQgaW1nSCA9IHRydWVIZWlnaHQgKiB0aGlzLnNjYWxlOwogICAgICAgICAgICAgICAgICAgIC8vIOWbvueJh3jovbTlgY/np7sKICAgICAgICAgICAgICAgICAgICBsZXQgZHggPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnggLQogICAgICAgICAgICAgICAgICAgICAgICBjcm9wT2Zmc2VydFggKwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRydWVXaWR0aCAqICgxIC0gdGhpcy5zY2FsZSkgLyAyOwogICAgICAgICAgICAgICAgICAgIC8vIOWbvueJh3novbTlgY/np7sKICAgICAgICAgICAgICAgICAgICBsZXQgZHkgPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnkgLQogICAgICAgICAgICAgICAgICAgICAgICBjcm9wT2Zmc2VydFkgKwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRydWVIZWlnaHQgKiAoMSAtIHRoaXMuc2NhbGUpIC8gMjsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhkeCwgZHkpCiAgICAgICAgICAgICAgICAgICAgLy8g5L+d5a2Y54q25oCBCiAgICAgICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocm90YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5mdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIGR4LCBkeSwgaW1nVywgaW1nSCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOi+k+WHuuWOn+WbvuavlOS+i+aIquWbvgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoIC8gdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0IC8gdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR4IC8gdGhpcy5zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgLyB0aGlzLnNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdXIC8gdGhpcy5zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nSCAvIHRoaXMuc2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAtMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5mdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5o2i566X5Zu+54mH5peL6L2s5ZCO55qE5Z2Q5qCH5byl6KGlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHggPSBkeCArIChpbWdXIC0gaW1nSCkgLyAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0gZHkgKyAoaW1nSCAtIGltZ1cpIC8gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0ZSAqIDkwICogTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIGR5LCAtZHggLSBpbWdILCBpbWdXLCBpbWdIKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGggLyB0aGlzLnNjYWxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQgLyB0aGlzLnNjYWxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOaNoueul+WbvueJh+aXi+i9rOWQjueahOWdkOagh+W8peihpQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR4ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHggLyB0aGlzLnNjYWxlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGltZ1cgLyB0aGlzLnNjYWxlIC0gaW1nSCAvIHRoaXMuc2NhbGUpIC8gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5IC8gdGhpcy5zY2FsZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbWdIIC8gdGhpcy5zY2FsZSAtIGltZ1cgLyB0aGlzLnNjYWxlKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShyb3RhdGUgKiA5MCAqIE1hdGguUEkgLyAxODApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHksIC1keCAtIGltZ0ggLyB0aGlzLnNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdXIC8gdGhpcy5zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nSCAvIHRoaXMuc2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAtMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5mdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShyb3RhdGUgKiA5MCAqIE1hdGguUEkgLyAxODApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZywgLWR4IC0gaW1nVywgLWR5IC0gaW1nSCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nVywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nSAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoIC8gdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0IC8gdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0ZSAqIDkwICogTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHggPSBkeCAvIHRoaXMuc2NhbGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSBkeSAvIHRoaXMuc2NhbGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nLCAtZHggLSBpbWdXIC8gdGhpcy5zY2FsZSwgLWR5IC0gaW1nSCAvIHRoaXMuc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZ1cgLyB0aGlzLnNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdIIC8gdGhpcy5zY2FsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIC0xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZ1bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmjaLnrpflm77niYfml4vovazlkI7nmoTlnZDmoIflvKXooaUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeCA9IGR4ICsgKGltZ1cgLSBpbWdIKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSBkeSArIChpbWdIIC0gaW1nVykgLyAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocm90YXRlICogOTAgKiBNYXRoLlBJIC8gMTgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgLWR5IC0gaW1nVywgZHgsIGltZ1csIGltZ0gpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aCAvIHRoaXMuc2NhbGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodCAvIHRoaXMuc2NhbGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5o2i566X5Zu+54mH5peL6L2s5ZCO55qE5Z2Q5qCH5byl6KGlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHggPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeCAvIHRoaXMuc2NhbGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW1nVyAvIHRoaXMuc2NhbGUgLSBpbWdIIC8gdGhpcy5zY2FsZSkgLyAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgLyB0aGlzLnNjYWxlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGltZ0ggLyB0aGlzLnNjYWxlIC0gaW1nVyAvIHRoaXMuc2NhbGUpIC8gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0ZSAqIDkwICogTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nLCAtZHkgLSBpbWdXIC8gdGhpcy5zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZ1cgLyB0aGlzLnNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdIIC8gdGhpcy5zY2FsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5mdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIGR4LCBkeSwgaW1nVywgaW1nSCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOi+k+WHuuWOn+WbvuavlOS+i+aIquWbvgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoIC8gdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0IC8gdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR4IC8gdGhpcy5zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgLyB0aGlzLnNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdXIC8gdGhpcy5zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nSCAvIHRoaXMuc2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsZXQgd2lkdGggPSB0cnVlV2lkdGggKiB0aGlzLnNjYWxlOwogICAgICAgICAgICAgICAgICAgIGxldCBoZWlnaHQgPSB0cnVlSGVpZ2h0ICogdGhpcy5zY2FsZTsKICAgICAgICAgICAgICAgICAgICBsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJvdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIC0zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5peL6L2sOTDluqYg5oiW6ICFLTI3MOW6piDlrr3luqblkozpq5jluqblr7nosIMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB3aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocm90YXRlICogOTAgKiBNYXRoLlBJIC8gMTgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAtaGVpZ2h0LCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgLTI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0ZSAqIDkwICogTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgLXdpZHRoLCAtaGVpZ2h0LCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgLTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gd2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0ZSAqIDkwICogTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgLXdpZHRoLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IGRhdGEgPSBjYW52YXMudG9EYXRhVVJMKAogICAgICAgICAgICAgICAgICAgICdpbWFnZS8nICsgdGhpcy5vdXRwdXRUeXBlLAogICAgICAgICAgICAgICAgICAgIHRoaXMub3V0cHV0U2l6ZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGNiKGRhdGEpOwogICAgICAgICAgICB9OwogICAgICAgICAgICAvLyDliKTmlq3lm77niYfmmK/lkKbmmK9iYXNlNjQKICAgICAgICAgICAgdmFyIHMgPSB0aGlzLmltZy5zdWJzdHIoMCwgNCk7CiAgICAgICAgICAgIGlmIChzICE9PSAnZGF0YScpIHsKICAgICAgICAgICAgICAgIGltZy5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGltZy5zcmMgPSB0aGlzLmltZ3M7CiAgICAgICAgfSwKICAgICAgICAvLyDovazljJZiYXNlNjQg5Li6YmxvYuWvueixoQogICAgICAgIGdldENyb3BCbG9iKGNiKSB7CiAgICAgICAgICAgIHRoaXMuZ2V0Q3JvcERhdGEoZGF0YSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgYXJyID0gZGF0YS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgdmFyIG1pbWUgPSBhcnJbMF0ubWF0Y2goLzooLio/KTsvKVsxXTsKICAgICAgICAgICAgICAgIHZhciBic3RyID0gYXRvYihhcnJbMV0pOwogICAgICAgICAgICAgICAgdmFyIG4gPSBic3RyLmxlbmd0aDsKICAgICAgICAgICAgICAgIHZhciB1OGFyciA9IG5ldyBVaW50OEFycmF5KG4pOwogICAgICAgICAgICAgICAgd2hpbGUgKG4tLSkgewogICAgICAgICAgICAgICAgICAgIHU4YXJyW25dID0gYnN0ci5jaGFyQ29kZUF0KG4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2IoCiAgICAgICAgICAgICAgICAgICAgbmV3IEJsb2IoW3U4YXJyXSwgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBtaW1lCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIC8vIOiHquWKqOmihOiniOWHveaVsAogICAgICAgIHNob3dQcmV2aWV3KCkgewogICAgICAgICAgICB2YXIgb2JqID0ge307CiAgICAgICAgICAgIG9iai5kaXYgPSB7CiAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5jcm9wVyArICdweCcsCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuY3JvcEggKyAncHgnCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG9iai5pbWcgPSB7CiAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy50cnVlV2lkdGggKyAncHgnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLnRydWVIZWlnaHQgKyAncHgnLAogICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAnc2NhbGUoJyArCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZSArCiAgICAgICAgICAgICAgICAgICAgJywnICsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlICsKICAgICAgICAgICAgICAgICAgICAnKSAnICsKICAgICAgICAgICAgICAgICAgICAndHJhbnNsYXRlM2QoJyArCiAgICAgICAgICAgICAgICAgICAgKHRoaXMueCAtIHRoaXMuY3JvcE9mZnNlcnRYKSAvIHRoaXMuc2NhbGUgKwogICAgICAgICAgICAgICAgICAgICdweCwnICsKICAgICAgICAgICAgICAgICAgICAodGhpcy55IC0gdGhpcy5jcm9wT2Zmc2VydFkpIC8gdGhpcy5zY2FsZSArCiAgICAgICAgICAgICAgICAgICAgJ3B4LCcgKwogICAgICAgICAgICAgICAgICAgICcwKScgKwogICAgICAgICAgICAgICAgICAgICdyb3RhdGVaKCcgKwogICAgICAgICAgICAgICAgICAgIHRoaXMucm90YXRlICogOTAgKwogICAgICAgICAgICAgICAgICAgICdkZWcpJwogICAgICAgICAgICB9OwogICAgICAgICAgICBvYmoudyA9IHRoaXMuY3JvcFc7CiAgICAgICAgICAgIG9iai5oID0gdGhpcy5jcm9wSDsKICAgICAgICAgICAgb2JqLnVybCA9IHRoaXMuaW1nczsKICAgICAgICAgICAgdGhpcy4kZW1pdCgncmVhbFRpbWUnLCBvYmopOwogICAgICAgIH0sCiAgICAgICAgLy8gcmVsb2FkIOWbvueJh+W4g+WxgOWHveaVsAogICAgICAgIHJlbG9hZCgpIHsKICAgICAgICAgICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICAgICAgLy8g6K+75Y+W5Zu+54mH55qE5L+h5oGv5Y6f5aeL5L+h5oGv77yMIOino+aekOaYr+WQpumcgOimgeaXi+i9rAogICAgICAgICAgICAgICAgLy8g6K+75Y+W5Zu+54mH55qE5peL6L2s5L+h5oGvCiAgICAgICAgICAgICAgICAvLyDlvpfliLDlpJblsYLlrrnlmajnmoTlrr3luqbpq5jluqYKICAgICAgICAgICAgICAgIHRoaXMudyA9IH5+d2luZG93CiAgICAgICAgICAgICAgICAgICAgLmdldENvbXB1dGVkU3R5bGUodGhpcy4kcmVmcy5jcm9wcGVyKQogICAgICAgICAgICAgICAgICAgIC53aWR0aC5yZXBsYWNlKCdweCcsICcnKTsKICAgICAgICAgICAgICAgIHRoaXMuaCA9IH5+d2luZG93CiAgICAgICAgICAgICAgICAgICAgLmdldENvbXB1dGVkU3R5bGUodGhpcy4kcmVmcy5jcm9wcGVyKQogICAgICAgICAgICAgICAgICAgIC5oZWlnaHQucmVwbGFjZSgncHgnLCAnJyk7CgogICAgICAgICAgICAgICAgLy8g5a2Y5YWl5Zu+54mH55yf5a6e6auY5bqmCiAgICAgICAgICAgICAgICB0aGlzLnRydWVXaWR0aCA9IGltZy53aWR0aDsKICAgICAgICAgICAgICAgIHRoaXMudHJ1ZUhlaWdodCA9IGltZy5oZWlnaHQ7CgogICAgICAgICAgICAgICAgLy8g5Yik5pat5piv5ZCm6ZyA6KaB5Y6L57yp5aSn5Zu+CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50cnVlV2lkdGggPiB0aGlzLncpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5Zu+54mH5a695bqm5aSn5LqO5a655Zmo5a695bqmCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGUgPSB0aGlzLncgLyB0aGlzLnRydWVXaWR0aDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRydWVIZWlnaHQgKiB0aGlzLnNjYWxlID4gdGhpcy5oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGUgPSB0aGlzLmggLyB0aGlzLnRydWVIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlID0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gLSh0aGlzLnRydWVXaWR0aCAtIHRoaXMudHJ1ZVdpZHRoICogdGhpcy5zY2FsZSkgLyAyICsKICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMudyAtIHRoaXMudHJ1ZVdpZHRoICogdGhpcy5zY2FsZSkgLyAyOwogICAgICAgICAgICAgICAgICAgIHRoaXMueSA9IC0odGhpcy50cnVlSGVpZ2h0IC0gdGhpcy50cnVlSGVpZ2h0ICogdGhpcy5zY2FsZSkgLyAyICsKICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuaCAtIHRoaXMudHJ1ZUhlaWdodCAqIHRoaXMuc2NhbGUpIC8gMjsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAvLyDojrflj5bmmK/lkKblvIDlkK/kuoboh6rliqjmiKrlm74KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdXRvQ3JvcCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdvQXV0b0Nyb3AoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g5Zu+54mH5Yqg6L295oiQ5Yqf55qE5Zue6LCDCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnaW1nTG9hZCcsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdpbWdMb2FkJywgJ2Vycm9yJyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGltZy5zcmMgPSB0aGlzLmltZ3M7CiAgICAgICAgfSwKICAgICAgICAvLyDoh6rliqjmiKrlm77lh73mlbAKICAgICAgICBnb0F1dG9Dcm9wKCkgewogICAgICAgICAgICB0aGlzLmNyb3BwaW5nID0gdHJ1ZTsKICAgICAgICAgICAgLy8g5oiq5Zu+5qGG6buY6K6k5aSn5bCPCiAgICAgICAgICAgIC8vIOWmguaenOS4ujAg6YKj5LmI6K6h566X5a655Zmo5aSn5bCPIOm7mOiupOS4ujgwJQogICAgICAgICAgICB2YXIgdyA9IHRoaXMuYXV0b0Nyb3BXaWR0aDsKICAgICAgICAgICAgdmFyIGggPSB0aGlzLmF1dG9Dcm9wSGVpZ2h0OwogICAgICAgICAgICBpZiAodyA9PT0gMCB8fCBoID09PSAwKSB7CiAgICAgICAgICAgICAgICB3ID0gdGhpcy53ICogMC44OwogICAgICAgICAgICAgICAgaCA9IHRoaXMuaCAqIDAuODsKICAgICAgICAgICAgfQogICAgICAgICAgICB3ID0gdyA+IHRoaXMudyA/IHRoaXMudyA6IHc7CiAgICAgICAgICAgIGggPSBoID4gdGhpcy5oID8gdGhpcy5oIDogaDsKICAgICAgICAgICAgaWYgKHRoaXMuZml4ZWQpIHsKICAgICAgICAgICAgICAgIGggPSB3IC8gdGhpcy5maXhlZE51bWJlclswXSAqIHRoaXMuZml4ZWROdW1iZXJbMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g5aaC5p6c5q+U5L6L5LmL5ZCOIOmrmOW6puWkp+S6jmgKICAgICAgICAgICAgaWYgKGggPiB0aGlzLmgpIHsKICAgICAgICAgICAgICAgIGggPSB0aGlzLmg7CiAgICAgICAgICAgICAgICB3ID0gaCAvIHRoaXMuZml4ZWROdW1iZXJbMV0gKiB0aGlzLmZpeGVkTnVtYmVyWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ3JvcCh3LCBoKTsKICAgICAgICB9LAogICAgICAgIC8vIOaJi+WKqOaUueWPmOaIquWbvuahhuWkp+Wwj+WHveaVsAogICAgICAgIGNoYW5nZUNyb3AodywgaCkgewogICAgICAgICAgICAvLyDliKTmlq3mmK/lkKblpKfkuo7lrrnlmagKICAgICAgICAgICAgdGhpcy5jcm9wVyA9IHc7CiAgICAgICAgICAgIHRoaXMuY3JvcEggPSBoOwogICAgICAgICAgICAvLyDlsYXkuK3otbDkuIDotbAKICAgICAgICAgICAgdGhpcy5jcm9wT2Zmc2VydFggPSAodGhpcy53IC0gdykgLyAyOwogICAgICAgICAgICB0aGlzLmNyb3BPZmZzZXJ0WSA9ICh0aGlzLmggLSBoKSAvIDI7CiAgICAgICAgfSwKICAgICAgICAvLyDph43nva7lh73mlbDvvIwg5oGi5aSN57uE5Lu2572u5Yid5aeL54q25oCBCiAgICAgICAgcmVmcmVzaCgpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3JlZnJlc2gnKQogICAgICAgICAgICB0aGlzLmltZ3MgPSAnJzsKICAgICAgICAgICAgdGhpcy5zY2FsZSA9IDE7CiAgICAgICAgICAgIHRoaXMuY3JvcCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnJvdGF0ZSA9IDA7CiAgICAgICAgICAgIHRoaXMudyA9IDA7CiAgICAgICAgICAgIHRoaXMuaCA9IDA7CiAgICAgICAgICAgIHRoaXMudHJ1ZVdpZHRoID0gMDsKICAgICAgICAgICAgdGhpcy50cnVlSGVpZ2h0ID0gMDsKICAgICAgICAgICAgdGhpcy5jbGVhckNyb3AoKTsKICAgICAgICB9LAoKICAgICAgICAvLyDlkJHlt6bovrnml4vovawKICAgICAgICByb3RhdGVMZWZ0KCkgewogICAgICAgICAgICB0aGlzLnJvdGF0ZSA9IHRoaXMucm90YXRlIDw9IC0zID8gMCA6IHRoaXMucm90YXRlIC0gMTsKICAgICAgICB9LAoKICAgICAgICAvLyDlkJHlj7Povrnml4vovawKICAgICAgICByb3RhdGVSaWdodCgpIHsKICAgICAgICAgICAgdGhpcy5yb3RhdGUgPSB0aGlzLnJvdGF0ZSA+PSAzID8gMCA6IHRoaXMucm90YXRlICsgMTsKICAgICAgICB9LAoKICAgICAgICAvLyDmuIXpmaTml4vovawKICAgICAgICByb3RhdGVDbGVhcigpIHsKICAgICAgICAgICAgdGhpcy5yb3RhdGUgPSAwOwogICAgICAgIH0KICAgIH0sCiAgICBtb3VudGVkKCkgewogICAgICAgIGxldCB0aGF0ID0gdGhpczsKICAgICAgICB0aGlzLnNob3dQcmV2aWV3KCk7CiAgICAgICAgdGhpcy5jaGVja2VkSW1nKCk7CiAgICAgICAgdmFyIHUgPSBuYXZpZ2F0b3IudXNlckFnZW50OwogICAgICAgIHRoaXMuaXNJT1MgPSAhIXUubWF0Y2goL1woaVteO10rOyggVTspPyBDUFUuK01hYyBPUyBYLyk7CiAgICAgICAgLy8g5YW85a65YmxvYgogICAgICAgIGlmICghSFRNTENhbnZhc0VsZW1lbnQucHJvdG90eXBlLnRvQmxvYikgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSFRNTENhbnZhc0VsZW1lbnQucHJvdG90eXBlLCAndG9CbG9iJywgewogICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKGNhbGxiYWNrLCB0eXBlLCBxdWFsaXR5KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJpblN0ciA9IGF0b2IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvRGF0YVVSTCh0eXBlLCBxdWFsaXR5KS5zcGxpdCgnLCcpWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IGJpblN0ci5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyciA9IG5ldyBVaW50OEFycmF5KGxlbik7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBhcnJbaV0gPSBiaW5TdHIuY2hhckNvZGVBdChpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBCbG9iKFthcnJdLCB7IHR5cGU6IHRoYXQudHlwZSB8fCAnaW1hZ2UvcG5nJyB9KQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KfTsKCg=="},{"version":3,"sources":["vue-cropper.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"vue-cropper.vue","sourceRoot":"src/components/vue-cropper","sourcesContent":["<template>\n    <div class=\"vue-cropper\" ref=\"cropper\" @mouseover=\"scaleImg\" @mouseout=\"cancleScale\">\n        <div class=\"cropper-box\">\n            <div class=\"cropper-box-canvas\" v-show=\"!loading\" :style=\"{\n                    'width': trueWidth + 'px',\n                    'height': trueHeight + 'px',\n                    'transform': 'scale(' + scale + ',' + scale + ') ' + 'translate3d('+ x / scale + 'px,' + y / scale + 'px,' + '0)'\n                    + 'rotateZ('+ rotate * 90 +'deg)'\n                    }\">\n                <img :src=\"imgs\" alt=\"cropper-img\" ref=\"cropperImg\" />\n            </div>\n        </div>\n        <div class=\"cropper-drag-box\" :class=\"{'cropper-move': move && !crop, 'cropper-crop': crop, 'cropper-modal': cropping}\" @mousedown=\"startMove\" @touchstart=\"startMove\">\n        </div>\n        <div v-show=\"cropping\" class=\"cropper-crop-box\" :style=\"{\n                    'width': cropW + 'px',\n                    'height': cropH + 'px',\n                    'transform': 'translate3d('+ cropOffsertX + 'px,' + cropOffsertY + 'px,' + '0)'\n                }\">\n            <span class=\"cropper-view-box\">\n                    <img\n                    :style=\"{\n                        'width': trueWidth + 'px',\n                        'height': trueHeight + 'px',\n                        'transform': 'scale(' + scale + ',' + scale + ') ' + 'translate3d('+ (x - cropOffsertX) / scale  + 'px,' + (y - cropOffsertY) / scale + 'px,' + '0)'\n                        + 'rotateZ('+ rotate * 90 +'deg)'\n                        }\"\n                        :src=\"imgs\"\n                        alt=\"cropper-img\"\n                        />\n                </span>\n            <span class=\"cropper-face cropper-move\" @mousedown=\"cropMove\" @touchstart=\"cropMove\"></span>\n            <span class=\"crop-info\" v-if=\"info\" :style=\"{'top': cropInfo}\">{{  this.cropW > 0 ? this.cropW : 0 }} × {{ this.cropH > 0 ? this.cropH : 0 }}</span>\n            <span v-if=\"!fixedBox\">\n                    <span class=\"crop-line line-w\" @mousedown=\"changeCropSize($event, false, true, 0, 1)\" @touchstart=\"changeCropSize($event, false, true, 0, 1)\"></span>\n            <span class=\"crop-line line-a\" @mousedown=\"changeCropSize($event, true, false, 1, 0)\" @touchstart=\"changeCropSize($event, true, false, 1, 0)\"></span>\n            <span class=\"crop-line line-s\" @mousedown=\"changeCropSize($event, false, true, 0, 2)\" @touchstart=\"changeCropSize($event, false, true, 0, 2)\"></span>\n            <span class=\"crop-line line-d\" @mousedown=\"changeCropSize($event, true, false, 2, 0)\" @touchstart=\"changeCropSize($event, true, false, 2, 0)\"></span>\n            <span class=\"crop-point point1\" @mousedown=\"changeCropSize($event, true, true, 1, 1)\" @touchstart=\"changeCropSize($event, true, true, 1, 1)\"></span>\n            <span class=\"crop-point point2\" @mousedown=\"changeCropSize($event, false, true, 0, 1)\" @touchstart=\"changeCropSize($event, false, true, 0, 1)\"></span>\n            <span class=\"crop-point point3\" @mousedown=\"changeCropSize($event, true, true, 2, 1)\" @touchstart=\"changeCropSize($event, true, true, 2, 1)\"></span>\n            <span class=\"crop-point point4\" @mousedown=\"changeCropSize($event, true, false, 1, 0)\" @touchstart=\"changeCropSize($event, true, false, 1, 0)\"></span>\n            <span class=\"crop-point point5\" @mousedown=\"changeCropSize($event, true, false, 2, 0)\" @touchstart=\"changeCropSize($event, true, false, 2, 0)\"></span>\n            <span class=\"crop-point point6\" @mousedown=\"changeCropSize($event, true, true, 1, 2)\" @touchstart=\"changeCropSize($event, true, true, 1, 2)\"></span>\n            <span class=\"crop-point point7\" @mousedown=\"changeCropSize($event, false, true, 0, 2)\" @touchstart=\"changeCropSize($event, false, true, 0, 2)\"></span>\n            <span class=\"crop-point point8\" @mousedown=\"changeCropSize($event, true, true, 2, 2)\" @touchstart=\"changeCropSize($event, true, true, 2, 2)\"></span>\n            </span>\n        </div>\n    </div>\n</template>\n<script>\nimport exif from 'exif-js';\nexport default {\n    data: function() {\n        return {\n            // 容器高宽\n            w: 0,\n            h: 0,\n            // 图片缩放比例\n            scale: 1,\n            // 图片偏移x轴\n            x: 0,\n            // 图片偏移y轴\n            y: 0,\n            // 图片加载\n            loading: true,\n            // 图片真实宽度\n            trueWidth: 0,\n            // 图片真实高度\n            trueHeight: 0,\n            move: true,\n            // 移动的x\n            moveX: 0,\n            // 移动的y\n            moveY: 0,\n            // 开启截图\n            crop: false,\n            // 正在截图\n            cropping: false,\n            // 裁剪框大小\n            cropW: 0,\n            cropH: 0,\n            cropOldW: 0,\n            cropOldH: 0,\n            // 判断是否能够改变\n            canChangeX: false,\n            canChangeY: false,\n            // 改变的基准点\n            changeCropTypeX: 1,\n            changeCropTypeY: 1,\n            // 裁剪框的坐标轴\n            cropX: 0,\n            cropY: 0,\n            cropChangeX: 0,\n            cropChangeY: 0,\n            cropOffsertX: 0,\n            cropOffsertY: 0,\n            // 支持的滚动事件\n            support: '',\n            // 移动端手指缩放\n            touches: [],\n            touchNow: false,\n            // 图片旋转\n            rotate: 0,\n            isIos: false,\n            orientation: 0,\n            imgs: '',\n            // 图片缩放系数\n            coe: 0.2,\n            // 是否正在多次缩放\n            scaling: false,\n            scalingSet: '',\n            coeStatus: ''\n        };\n    },\n    props: {\n        img: {\n            type: String,\n            default: ''\n        },\n        // 输出图片压缩比\n        outputSize: {\n            type: Number,\n            default: 1\n        },\n        outputType: {\n            type: String,\n            default: 'jpeg'\n        },\n        info: {\n            type: Boolean,\n            default: true\n        },\n        // 是否开启滚轮放大缩小\n        canScale: {\n            type: Boolean,\n            default: true\n        },\n        // 是否自成截图框\n        autoCrop: {\n            type: Boolean,\n            default: false\n        },\n        autoCropWidth: {\n            type: Number,\n            default: 0\n        },\n        autoCropHeight: {\n            type: Number,\n            default: 0\n        },\n        // 是否开启固定宽高比\n        fixed: {\n            type: Boolean,\n            default: false\n        },\n        // 宽高比 w/h\n        fixedNumber: {\n            type: Array,\n            default: () => {\n                return [1, 1];\n            }\n        },\n        // 固定大小 禁止改变截图框大小\n        fixedBox: {\n            type: Boolean,\n            default: false\n        },\n        // 输出截图是否缩放\n        full: {\n            type: Boolean,\n            default: false\n        },\n        // 是否可以拖动图片\n        canMove: {\n            type: Boolean,\n            default: true\n        },\n        // 是否可以拖动截图框\n        canMoveBox: {\n            type: Boolean,\n            default: true\n        },\n        // 上传图片按照原始比例显示\n        original: {\n            type: Boolean,\n            default: false\n        }\n    },\n    computed: {\n        cropInfo() {\n            return this.cropOffsertY > 20 ? '-20px' : '0px';\n        }\n    },\n    watch: {\n        // 如果图片改变， 重新布局\n        img() {\n            // 当传入图片时, 读取图片信息同时展示\n            this.checkedImg();\n        },\n        imgs(val) {\n            if (val === '') {\n                return;\n            }\n            this.reload();\n        },\n        cropW() {\n            this.cropW = ~~this.cropW;\n            this.showPreview();\n        },\n        cropH() {\n            this.cropH = ~~this.cropH;\n            this.showPreview();\n        },\n        cropOffsertX() {\n            this.showPreview();\n        },\n        cropOffsertY() {\n            this.showPreview();\n        },\n        scale() {\n            this.showPreview();\n        },\n        x() {\n            this.showPreview();\n        },\n        y() {\n            this.showPreview();\n        },\n        rotate() {\n            this.showPreview();\n        }\n    },\n    methods: {\n        // 校验图片\n        checkedImg() {\n            if (this.img === '') return;\n            this.loading = true;\n            this.scale = 1;\n            this.clearCrop();\n            let canvas = document.createElement('canvas');\n            let img = new Image();\n            let rotate = 0;\n            img.onload = () => {\n                let width = img.width;\n                let height = img.height;\n                let ctx = canvas.getContext('2d');\n                ctx.save();\n                exif.getData(img, () => {\n                    exif.getAllTags(img);\n                    this.orientation = exif.getTag(img, 'Orientation');\n                    switch (this.orientation) {\n                        case 6:\n                            rotate = 1;\n                            break;\n                        case 8:\n                            rotate = -1;\n                            break;\n                        case 3:\n                            rotate = 3;\n                            break;\n                        default:\n                            rotate = 0;\n                    }\n                    if (rotate === 0) {\n                        this.imgs = this.img;\n                        return;\n                    }\n                    switch (rotate) {\n                        case 0:\n                            canvas.width = width;\n                            canvas.height = height;\n                            ctx.drawImage(img, 0, 0, width, height);\n                            break;\n                        case 1:\n                        case -3:\n                            // 旋转90度 或者-270度 宽度和高度对调\n                            canvas.width = height;\n                            canvas.height = width;\n                            ctx.rotate(rotate * 90 * Math.PI / 180);\n                            ctx.drawImage(img, 0, -height, width, height);\n                            break;\n                        case 2:\n                        case -2:\n                            canvas.width = width;\n                            canvas.height = height;\n                            ctx.rotate(rotate * 90 * Math.PI / 180);\n                            ctx.drawImage(img, -width, -height, width, height);\n                            break;\n                        case 3:\n                        case -1:\n                            canvas.width = height;\n                            canvas.height = width;\n                            ctx.rotate(rotate * 90 * Math.PI / 180);\n                            ctx.drawImage(img, -width, 0, width, height);\n                            break;\n                        default:\n                            canvas.width = width;\n                            canvas.height = height;\n                            ctx.drawImage(img, 0, 0, width, height);\n                    }\n                    ctx.restore();\n                    canvas.toBlob(\n                        blob => {\n                            let data = URL.createObjectURL(blob);\n                            this.imgs = data;\n                        },\n                        'image/' + this.outputType,\n                        1\n                    );\n                });\n            };\n            img.onerror = () => {\n                this.$emit('imgLoad', 'error');\n            };\n            img.crossOrigin = '*';\n            img.src = this.img;\n        },\n        // 当按下鼠标键\n        startMove(e) {\n            e.preventDefault();\n            // 如果move 为true 表示当前可以拖动\n            if (this.move && !this.crop) {\n                if (!this.canMove) {\n                    return false;\n                }\n                // 开始移动\n                this.moveX =\n                    (e.clientX ? e.clientX : e.touches[0].clientX) - this.x;\n                this.moveY =\n                    (e.clientY ? e.clientY : e.touches[0].clientY) - this.y;\n                if (e.touches) {\n                    window.addEventListener('touchmove', this.moveImg);\n                    window.addEventListener('touchend', this.leaveImg);\n                    if (e.touches.length == 2) {\n                        // 记录手指刚刚放上去\n                        this.touches = e.touches;\n                        window.addEventListener('touchmove', this.touchScale);\n                        window.addEventListener(\n                            'touchend',\n                            this.cancleTouchScale\n                        );\n                    }\n                } else {\n                    window.addEventListener('mousemove', this.moveImg);\n                    window.addEventListener('mouseup', this.leaveImg);\n                }\n            } else {\n                // 截图ing\n                this.cropping = true;\n                // 绑定截图事件\n                window.addEventListener('mousemove', this.createCrop);\n                window.addEventListener('mouseup', this.endCrop);\n                window.addEventListener('touchmove', this.createCrop);\n                window.addEventListener('touchend', this.endCrop);\n                this.cropOffsertX = e.offsetX ?\n                    e.offsetX :\n                    e.touches[0].pageX - this.$refs.cropper.offsetLeft;\n                this.cropOffsertY = e.offsetY ?\n                    e.offsetY :\n                    e.touches[0].pageY - this.$refs.cropper.offsetTop;\n                this.cropX = e.clientX ? e.clientX : e.touches[0].clientX;\n                this.cropY = e.clientY ? e.clientY : e.touches[0].clientY;\n                this.cropChangeX = this.cropOffsertX;\n                this.cropChangeY = this.cropOffsertY;\n                this.cropW = 0;\n                this.cropH = 0;\n            }\n        },\n\n        // 移动端缩放\n        touchScale(e) {\n            e.preventDefault();\n            // 记录变化量\n            // 第一根手指\n            var oldTouch1 = {\n                x: this.touches[0].clientX,\n                y: this.touches[0].clientY\n            };\n            var newTouch1 = {\n                x: e.touches[0].clientX,\n                y: e.touches[0].clientY\n            };\n            // 第二根手指\n            var oldTouch2 = {\n                x: this.touches[1].clientX,\n                y: this.touches[1].clientY\n            };\n            var newTouch2 = {\n                x: e.touches[1].clientX,\n                y: e.touches[1].clientY\n            };\n            var oldL = Math.sqrt(\n                Math.pow(oldTouch1.x - oldTouch2.x, 2) +\n                Math.pow(oldTouch1.y - oldTouch2.y, 2)\n            );\n            var newL = Math.sqrt(\n                Math.pow(newTouch1.x - newTouch2.x, 2) +\n                Math.pow(newTouch1.y - newTouch2.y, 2)\n            );\n            var cha = ~~(newL - oldL);\n            // 根据图片本身大小 决定每次改变大小的系数, 图片越大系数越小\n            // 1px - 0.2\n            var coe = 1;\n            coe =\n                coe / this.trueWidth > coe / this.trueHeight ?\n                coe / this.trueHeight :\n                coe / this.trueWidth;\n            coe = coe > 0.1 ? 0.1 : coe;\n            var num = coe * cha;\n            if (!this.touchNow) {\n                this.touchNow = true;\n                if (cha > 0) {\n                    this.scale += Math.abs(num);\n                } else if (cha < 0) {\n                    this.scale > Math.abs(num) ?\n                        (this.scale -= Math.abs(num)) :\n                        this.scale;\n                }\n                this.touches = e.touches;\n                setTimeout(() => {\n                    this.touchNow = false;\n                }, 8);\n            }\n        },\n\n        cancleTouchScale(e) {\n            window.removeEventListener('touchmove', this.touchScale);\n        },\n\n        // 移动图片\n        moveImg(e) {\n            e.preventDefault();\n            if (e.touches && e.touches.length === 2) {\n                this.touches = e.touches;\n                window.addEventListener('touchmove', this.touchScale);\n                window.addEventListener('touchend', this.cancleTouchScale);\n                window.removeEventListener('touchmove', this.moveImg);\n                return false;\n            }\n            var nowX = e.clientX ? e.clientX : e.touches[0].clientX;\n            var nowY = e.clientY ? e.clientY : e.touches[0].clientY;\n            this.$nextTick(() => {\n                this.x = ~~(nowX - this.moveX);\n                this.y = ~~(nowY - this.moveY);\n            });\n        },\n        // 移动图片结束\n        leaveImg(e) {\n            window.removeEventListener('mousemove', this.moveImg);\n            window.removeEventListener('touchmove', this.moveImg);\n            window.removeEventListener('mouseup', this.leaveImg);\n            window.removeEventListener('touchend', this.leaveImg);\n        },\n        // 缩放图片\n        scaleImg() {\n            this.support =\n                'onwheel' in document.createElement('div') ?\n                'wheel' :\n                document.onmousewheel !== undefined ?\n                'mousewheel' :\n                'DOMMouseScroll';\n            if (this.canScale) {\n                window.addEventListener(this.support, this.changeSize);\n            }\n        },\n        // 移出框\n        cancleScale() {\n            if (this.canScale) {\n                window.removeEventListener(this.support, this.changeSize);\n            }\n        },\n        // 改变大小函数\n        changeSize(e) {\n            e.preventDefault();\n            var change = e.deltaY || e.wheelDelta;\n            // 根据图片本身大小 决定每次改变大小的系数, 图片越大系数越小\n            var isFirefox = navigator.userAgent.indexOf('Firefox');\n            change = isFirefox > 0 ? change * 30 : change;\n            // 1px - 0.2\n            var coe = this.coe;\n            coe =\n                coe / this.trueWidth > coe / this.trueHeight ?\n                coe / this.trueHeight :\n                coe / this.trueWidth;\n            var num = coe * change;\n            num < 0 ?\n                (this.scale += Math.abs(num)) :\n                this.scale > Math.abs(num) ?\n                (this.scale -= Math.abs(num)) :\n                this.scale;\n            // 延迟0.1s 每次放大大或者缩小的范围\n            let status = num < 0 ? 'add' : 'reduce';\n            if (status !== this.coeStatus) {\n                this.coeStatus = status;\n                this.coe = 0.2;\n            }\n            if (!this.scaling) {\n                this.scalingSet = setTimeout(() => {\n                    this.scaling = false;\n                    this.coe = this.coe += 0.01;\n                }, 50);\n            }\n            this.scaling = true;\n        },\n\n        // 修改图片大小函数\n        changeScale(num) {\n            num = num || 1;\n            var coe = 20;\n            coe =\n                coe / this.trueWidth > coe / this.trueHeight ?\n                coe / this.trueHeight :\n                coe / this.trueWidth;\n            num = num * coe;\n            num > 0 ?\n                (this.scale += Math.abs(num)) :\n                this.scale > Math.abs(num) ?\n                (this.scale -= Math.abs(num)) :\n                this.scale;\n        },\n        // 创建截图框\n        createCrop(e) {\n            e.preventDefault();\n            // 移动生成大小\n            var nowX = e.clientX ?\n                e.clientX :\n                e.touches ? e.touches[0].clientX : 0;\n            var nowY = e.clientY ?\n                e.clientY :\n                e.touches ? e.touches[0].clientY : 0;\n            this.$nextTick(() => {\n                var fw = ~~(nowX - this.cropX);\n                var fh = ~~(nowY - this.cropY);\n                if (fw > 0) {\n                    this.cropW =\n                        fw + this.cropChangeX > this.w ?\n                        this.w - this.cropChangeX :\n                        fw;\n                    this.cropOffsertX = this.cropChangeX;\n                } else {\n                    this.cropW =\n                        this.w - this.cropChangeX + Math.abs(fw) > this.w ?\n                        this.cropChangeX :\n                        Math.abs(fw);\n                    this.cropOffsertX =\n                        this.cropChangeX + fw > 0 ? this.cropChangeX + fw : 0;\n                }\n\n                if (!this.fixed) {\n                    if (fh > 0) {\n                        this.cropH =\n                            fh + this.cropChangeY > this.h ?\n                            this.h - this.cropChangeY :\n                            fh;\n                        this.cropOffsertY = this.cropChangeY;\n                    } else {\n                        this.cropH =\n                            this.h - this.cropChangeY + Math.abs(fh) > this.h ?\n                            this.cropChangeY :\n                            Math.abs(fh);\n                        this.cropOffsertY =\n                            this.cropChangeY + fh > 0 ?\n                            this.cropChangeY + fh :\n                            0;\n                    }\n                } else {\n                    var fixedHeight = ~~(\n                        this.cropW /\n                        this.fixedNumber[0] *\n                        this.fixedNumber[1]\n                    );\n                    if (fixedHeight + this.cropOffsertY > this.h) {\n                        this.cropH = this.h - this.cropOffsertY;\n                        this.cropW = ~~(\n                            this.cropH /\n                            this.fixedNumber[1] *\n                            this.fixedNumber[0]\n                        );\n                        if (fw > 0) {\n                            this.cropOffsertX = this.cropChangeX;\n                        } else {\n                            this.cropOffsertX = this.cropChangeX - this.cropW;\n                        }\n                    } else {\n                        this.cropH = fixedHeight;\n                    }\n                    this.cropOffsertY = this.cropOffsertY;\n                }\n            });\n        },\n\n        // 改变截图框大小\n        changeCropSize(e, w, h, typeW, typeH) {\n            e.preventDefault();\n            window.addEventListener('mousemove', this.changeCropNow);\n            window.addEventListener('mouseup', this.changeCropEnd);\n            window.addEventListener('touchmove', this.changeCropNow);\n            window.addEventListener('touchend', this.changeCropEnd);\n            this.canChangeX = w;\n            this.canChangeY = h;\n            this.changeCropTypeX = typeW;\n            this.changeCropTypeY = typeH;\n            this.cropX = e.clientX ? e.clientX : e.touches[0].clientX;\n            this.cropY = e.clientY ? e.clientY : e.touches[0].clientY;\n            this.cropOldW = this.cropW;\n            this.cropOldH = this.cropH;\n            this.cropChangeX = this.cropOffsertX;\n            this.cropChangeY = this.cropOffsertY;\n            if (this.fixed) {\n                if (this.canChangeX && this.canChangeY) {\n                    this.canChangeY = 0;\n                }\n            }\n        },\n\n        // 正在改变\n        changeCropNow(e) {\n            e.preventDefault();\n            var nowX = e.clientX ?\n                e.clientX :\n                e.touches ? e.touches[0].clientX : 0;\n            var nowY = e.clientY ?\n                e.clientY :\n                e.touches ? e.touches[0].clientY : 0;\n            this.$nextTick(() => {\n                var fw = ~~(nowX - this.cropX);\n                var fh = ~~(nowY - this.cropY);\n                if (this.canChangeX) {\n                    if (this.changeCropTypeX === 1) {\n                        if (this.cropOldW - fw > 0) {\n                            this.cropW =\n                                this.w - this.cropChangeX - fw <= this.w ?\n                                this.cropOldW - fw :\n                                this.cropOldW + this.cropChangeX;\n                            this.cropOffsertX =\n                                this.w - this.cropChangeX - fw <= this.w ?\n                                this.cropChangeX + fw :\n                                0;\n                        } else {\n                            this.cropW =\n                                Math.abs(fw) + this.cropChangeX <= this.w ?\n                                Math.abs(fw) - this.cropOldW :\n                                this.w - this.cropOldW - this.cropChangeX;\n                            this.cropOffsertX =\n                                this.cropChangeX + this.cropOldW;\n                        }\n                    } else if (this.changeCropTypeX === 2) {\n                        if (this.cropOldW + fw > 0) {\n                            this.cropW =\n                                this.cropOldW + fw + this.cropOffsertX <= this.w ?\n                                this.cropOldW + fw :\n                                this.w - this.cropOffsertX;\n                            this.cropOffsertX = this.cropChangeX;\n                        } else {\n                            this.cropW =\n                                this.w -\n                                this.cropChangeX +\n                                Math.abs(fw + this.cropOldW) <=\n                                this.w ?\n                                Math.abs(fw + this.cropOldW) :\n                                this.cropChangeX;\n                            this.cropOffsertX =\n                                this.w -\n                                this.cropChangeX +\n                                Math.abs(fw + this.cropOldW) <=\n                                this.w ?\n                                this.cropChangeX -\n                                Math.abs(fw + this.cropOldW) :\n                                0;\n                        }\n                    }\n                }\n\n                if (this.canChangeY) {\n                    if (this.changeCropTypeY === 1) {\n                        if (this.cropOldH - fh > 0) {\n                            this.cropH =\n                                this.h - this.cropChangeY - fh <= this.h ?\n                                this.cropOldH - fh :\n                                this.cropOldH + this.cropChangeY;\n                            this.cropOffsertY =\n                                this.h - this.cropChangeY - fh <= this.h ?\n                                this.cropChangeY + fh :\n                                0;\n                        } else {\n                            this.cropH =\n                                Math.abs(fh) + this.cropChangeY <= this.h ?\n                                Math.abs(fh) - this.cropOldH :\n                                this.h - this.cropOldH - this.cropChangeY;\n                            this.cropOffsertY =\n                                this.cropChangeY + this.cropOldH;\n                        }\n                    } else if (this.changeCropTypeY === 2) {\n                        if (this.cropOldH + fh > 0) {\n                            this.cropH =\n                                this.cropOldH + fh + this.cropOffsertY <= this.h ?\n                                this.cropOldH + fh :\n                                this.h - this.cropOffsertY;\n                            this.cropOffsertY = this.cropChangeY;\n                        } else {\n                            this.cropH =\n                                this.h -\n                                this.cropChangeY +\n                                Math.abs(fh + this.cropOldH) <=\n                                this.h ?\n                                Math.abs(fh + this.cropOldH) :\n                                this.cropChangeY;\n                            this.cropOffsertY =\n                                this.h -\n                                this.cropChangeY +\n                                Math.abs(fh + this.cropOldH) <=\n                                this.h ?\n                                this.cropChangeY -\n                                Math.abs(fh + this.cropOldH) :\n                                0;\n                        }\n                    }\n                }\n\n                if (this.canChangeX && this.fixed) {\n                    var fixedHeight = ~~(\n                        this.cropW /\n                        this.fixedNumber[0] *\n                        this.fixedNumber[1]\n                    );\n                    if (fixedHeight + this.cropOffsertY > this.h) {\n                        this.cropH = this.h - this.cropOffsertY;\n                        this.cropW = ~~(\n                            this.cropH /\n                            this.fixedNumber[1] *\n                            this.fixedNumber[0]\n                        );\n                    } else {\n                        this.cropH = fixedHeight;\n                    }\n                }\n\n                if (this.canChangeY && this.fixed) {\n                    var fixedWidth = ~~(\n                        this.cropH /\n                        this.fixedNumber[1] *\n                        this.fixedNumber[0]\n                    );\n                    if (fixedWidth + this.cropOffsertX > this.w) {\n                        this.cropW = this.w - this.cropOffsertX;\n                        this.cropH = ~~(\n                            this.cropW /\n                            this.fixedNumber[0] *\n                            this.fixedNumber[1]\n                        );\n                    } else {\n                        this.cropW = fixedWidth;\n                    }\n                }\n            });\n        },\n\n        // 结束改变\n        changeCropEnd(e) {\n            window.removeEventListener('mousemove', this.changeCropNow);\n            window.removeEventListener('mouseup', this.changeCropEnd);\n            window.removeEventListener('touchmove', this.changeCropNow);\n            window.removeEventListener('touchend', this.changeCropEnd);\n        },\n\n        // 创建完成\n        endCrop() {\n            if (this.cropW === 0 && this.cropH === 0) {\n                this.cropping = false;\n            }\n            window.removeEventListener('mousemove', this.createCrop);\n            window.removeEventListener('mouseup', this.endCrop);\n            window.removeEventListener('touchmove', this.createCrop);\n            window.removeEventListener('touchend', this.endCrop);\n        },\n        // 开始截图\n        startCrop() {\n            this.crop = true;\n            // console.log('开始截图')\n        },\n        // 停止截图\n        stopCrop() {\n            this.crop = false;\n            // console.log('停止截图')\n        },\n        // 清除截图\n        clearCrop() {\n            this.cropping = false;\n            this.cropW = 0;\n            this.cropH = 0;\n            // console.log('清除截图')\n        },\n        // 截图移动\n        cropMove(e) {\n            e.preventDefault();\n            if (!this.canMoveBox) {\n                this.crop = false;\n                this.startMove(e);\n                return false;\n            }\n            window.addEventListener('mousemove', this.moveCrop);\n            window.addEventListener('mouseup', this.leaveCrop);\n            window.addEventListener('touchmove', this.moveCrop);\n            window.addEventListener('touchend', this.leaveCrop);\n            this.cropX =\n                (e.clientX ? e.clientX : e.touches[0].clientX) -\n                this.cropOffsertX;\n            this.cropY =\n                (e.clientY ? e.clientY : e.touches[0].clientY) -\n                this.cropOffsertY;\n        },\n\n        moveCrop(e) {\n            e.preventDefault();\n            var nowX = e.clientX ? e.clientX : e.touches[0].clientX;\n            var nowY = e.clientY ? e.clientY : e.touches[0].clientY;\n            this.$nextTick(() => {\n                var fw = ~~(nowX - this.cropX);\n                var fh = ~~(nowY - this.cropY);\n                if (fw <= 1) {\n                    this.cropOffsertX = 1;\n                } else if (~~(fw + this.cropW) > this.w) {\n                    this.cropOffsertX = this.w - this.cropW - 1;\n                } else {\n                    this.cropOffsertX = fw;\n                }\n\n                if (fh <= 1) {\n                    this.cropOffsertY = 1;\n                } else if (~~(fh + this.cropH) > this.h) {\n                    this.cropOffsertY = this.h - this.cropH - 1;\n                } else {\n                    this.cropOffsertY = fh;\n                }\n            });\n        },\n\n        leaveCrop(e) {\n            window.removeEventListener('mousemove', this.moveCrop);\n            window.removeEventListener('mouseup', this.leaveCrop);\n            window.removeEventListener('touchmove', this.moveCrop);\n            window.removeEventListener('touchend', this.leaveCrop);\n        },\n        // 获取转换成base64 的图片信息\n        getCropData(cb) {\n            let canvas = document.createElement('canvas');\n            let img = new Image();\n            let rotate = this.rotate;\n            let trueWidth = this.trueWidth;\n            let trueHeight = this.trueHeight;\n            let cropOffsertX = this.cropOffsertX;\n            let cropOffsertY = this.cropOffsertY;\n            img.onload = () => {\n                if (~~this.cropW !== 0) {\n                    let ctx = canvas.getContext('2d');\n                    let width = this.cropW;\n                    let height = this.cropH;\n                    let imgW = trueWidth * this.scale;\n                    let imgH = trueHeight * this.scale;\n                    // 图片x轴偏移\n                    let dx =\n                        this.x -\n                        cropOffsertX +\n                        this.trueWidth * (1 - this.scale) / 2;\n                    // 图片y轴偏移\n                    let dy =\n                        this.y -\n                        cropOffsertY +\n                        this.trueHeight * (1 - this.scale) / 2;\n                    // console.log(dx, dy)\n                    // 保存状态\n                    canvas.width = width;\n                    canvas.height = height;\n                    ctx.save();\n                    switch (rotate) {\n                        case 0:\n                            if (!this.full) {\n                                ctx.drawImage(img, dx, dy, imgW, imgH);\n                            } else {\n                                // 输出原图比例截图\n                                canvas.width = width / this.scale;\n                                canvas.height = height / this.scale;\n                                ctx.drawImage(\n                                    img,\n                                    dx / this.scale,\n                                    dy / this.scale,\n                                    imgW / this.scale,\n                                    imgH / this.scale\n                                );\n                            }\n                            break;\n                        case 1:\n                        case -3:\n                            if (!this.full) {\n                                // 换算图片旋转后的坐标弥补\n                                dx = dx + (imgW - imgH) / 2;\n                                dy = dy + (imgH - imgW) / 2;\n                                ctx.rotate(rotate * 90 * Math.PI / 180);\n                                ctx.drawImage(img, dy, -dx - imgH, imgW, imgH);\n                            } else {\n                                canvas.width = width / this.scale;\n                                canvas.height = height / this.scale;\n                                // 换算图片旋转后的坐标弥补\n                                dx =\n                                    dx / this.scale +\n                                    (imgW / this.scale - imgH / this.scale) / 2;\n                                dy =\n                                    dy / this.scale +\n                                    (imgH / this.scale - imgW / this.scale) / 2;\n                                ctx.rotate(rotate * 90 * Math.PI / 180);\n                                ctx.drawImage(\n                                    img,\n                                    dy, -dx - imgH / this.scale,\n                                    imgW / this.scale,\n                                    imgH / this.scale\n                                );\n                            }\n                            break;\n                        case 2:\n                        case -2:\n                            if (!this.full) {\n                                ctx.rotate(rotate * 90 * Math.PI / 180);\n                                ctx.drawImage(\n                                    img, -dx - imgW, -dy - imgH,\n                                    imgW,\n                                    imgH\n                                );\n                            } else {\n                                canvas.width = width / this.scale;\n                                canvas.height = height / this.scale;\n                                ctx.rotate(rotate * 90 * Math.PI / 180);\n                                dx = dx / this.scale;\n                                dy = dy / this.scale;\n                                ctx.drawImage(\n                                    img, -dx - imgW / this.scale, -dy - imgH / this.scale,\n                                    imgW / this.scale,\n                                    imgH / this.scale\n                                );\n                            }\n                            break;\n                        case 3:\n                        case -1:\n                            if (!this.full) {\n                                // 换算图片旋转后的坐标弥补\n                                dx = dx + (imgW - imgH) / 2;\n                                dy = dy + (imgH - imgW) / 2;\n                                ctx.rotate(rotate * 90 * Math.PI / 180);\n                                ctx.drawImage(img, -dy - imgW, dx, imgW, imgH);\n                            } else {\n                                canvas.width = width / this.scale;\n                                canvas.height = height / this.scale;\n                                // 换算图片旋转后的坐标弥补\n                                dx =\n                                    dx / this.scale +\n                                    (imgW / this.scale - imgH / this.scale) / 2;\n                                dy =\n                                    dy / this.scale +\n                                    (imgH / this.scale - imgW / this.scale) / 2;\n                                ctx.rotate(rotate * 90 * Math.PI / 180);\n                                ctx.drawImage(\n                                    img, -dy - imgW / this.scale,\n                                    dx,\n                                    imgW / this.scale,\n                                    imgH / this.scale\n                                );\n                            }\n                            break;\n                        default:\n                            if (!this.full) {\n                                ctx.drawImage(img, dx, dy, imgW, imgH);\n                            } else {\n                                // 输出原图比例截图\n                                canvas.width = width / this.scale;\n                                canvas.height = height / this.scale;\n                                ctx.drawImage(\n                                    img,\n                                    dx / this.scale,\n                                    dy / this.scale,\n                                    imgW / this.scale,\n                                    imgH / this.scale\n                                );\n                            }\n                    }\n                    ctx.restore();\n                } else {\n                    let width = trueWidth * this.scale;\n                    let height = trueHeight * this.scale;\n                    let ctx = canvas.getContext('2d');\n                    ctx.save();\n                    switch (rotate) {\n                        case 0:\n                            canvas.width = width;\n                            canvas.height = height;\n                            ctx.drawImage(img, 0, 0, width, height);\n                            break;\n                        case 1:\n                        case -3:\n                            // 旋转90度 或者-270度 宽度和高度对调\n                            canvas.width = height;\n                            canvas.height = width;\n                            ctx.rotate(rotate * 90 * Math.PI / 180);\n                            ctx.drawImage(img, 0, -height, width, height);\n                            break;\n                        case 2:\n                        case -2:\n                            canvas.width = width;\n                            canvas.height = height;\n                            ctx.rotate(rotate * 90 * Math.PI / 180);\n                            ctx.drawImage(img, -width, -height, width, height);\n                            break;\n                        case 3:\n                        case -1:\n                            canvas.width = height;\n                            canvas.height = width;\n                            ctx.rotate(rotate * 90 * Math.PI / 180);\n                            ctx.drawImage(img, -width, 0, width, height);\n                            break;\n                        default:\n                            canvas.width = width;\n                            canvas.height = height;\n                            ctx.drawImage(img, 0, 0, width, height);\n                    }\n                    ctx.restore();\n                }\n                let data = canvas.toDataURL(\n                    'image/' + this.outputType,\n                    this.outputSize\n                );\n                cb(data);\n            };\n            // 判断图片是否是base64\n            var s = this.img.substr(0, 4);\n            if (s !== 'data') {\n                img.crossOrigin = 'anonymous';\n            }\n            img.src = this.imgs;\n        },\n        // 转化base64 为blob对象\n        getCropBlob(cb) {\n            this.getCropData(data => {\n                var arr = data.split(',');\n                var mime = arr[0].match(/:(.*?);/)[1];\n                var bstr = atob(arr[1]);\n                var n = bstr.length;\n                var u8arr = new Uint8Array(n);\n                while (n--) {\n                    u8arr[n] = bstr.charCodeAt(n);\n                }\n                cb(\n                    new Blob([u8arr], {\n                        type: mime\n                    })\n                );\n            });\n        },\n\n        // 自动预览函数\n        showPreview() {\n            var obj = {};\n            obj.div = {\n                width: this.cropW + 'px',\n                height: this.cropH + 'px'\n            };\n            obj.img = {\n                width: this.trueWidth + 'px',\n                height: this.trueHeight + 'px',\n                transform: 'scale(' +\n                    this.scale +\n                    ',' +\n                    this.scale +\n                    ') ' +\n                    'translate3d(' +\n                    (this.x - this.cropOffsertX) / this.scale +\n                    'px,' +\n                    (this.y - this.cropOffsertY) / this.scale +\n                    'px,' +\n                    '0)' +\n                    'rotateZ(' +\n                    this.rotate * 90 +\n                    'deg)'\n            };\n            obj.w = this.cropW;\n            obj.h = this.cropH;\n            obj.url = this.imgs;\n            this.$emit('realTime', obj);\n        },\n        // reload 图片布局函数\n        reload() {\n            let img = new Image();\n            img.onload = () => {\n                // 读取图片的信息原始信息， 解析是否需要旋转\n                // 读取图片的旋转信息\n                // 得到外层容器的宽度高度\n                this.w = ~~window\n                    .getComputedStyle(this.$refs.cropper)\n                    .width.replace('px', '');\n                this.h = ~~window\n                    .getComputedStyle(this.$refs.cropper)\n                    .height.replace('px', '');\n\n                // 存入图片真实高度\n                this.trueWidth = img.width;\n                this.trueHeight = img.height;\n\n                // 判断是否需要压缩大图\n                if (!this.original) {\n                    if (this.trueWidth > this.w) {\n                        // 如果图片宽度大于容器宽度\n                        this.scale = this.w / this.trueWidth;\n                    }\n\n                    if (this.trueHeight * this.scale > this.h) {\n                        this.scale = this.h / this.trueHeight;\n                    }\n                } else {\n                    this.scale = 1;\n                }\n\n                this.$nextTick(() => {\n                    this.x = -(this.trueWidth - this.trueWidth * this.scale) / 2 +\n                        (this.w - this.trueWidth * this.scale) / 2;\n                    this.y = -(this.trueHeight - this.trueHeight * this.scale) / 2 +\n                        (this.h - this.trueHeight * this.scale) / 2;\n                    this.loading = false;\n                    // 获取是否开启了自动截图\n                    if (this.autoCrop) {\n                        this.goAutoCrop();\n                    }\n                    // 图片加载成功的回调\n                    this.$emit('imgLoad', 'success');\n                });\n            };\n            img.onerror = () => {\n                this.$emit('imgLoad', 'error');\n            };\n            img.src = this.imgs;\n        },\n        // 自动截图函数\n        goAutoCrop() {\n            this.cropping = true;\n            // 截图框默认大小\n            // 如果为0 那么计算容器大小 默认为80%\n            var w = this.autoCropWidth;\n            var h = this.autoCropHeight;\n            if (w === 0 || h === 0) {\n                w = this.w * 0.8;\n                h = this.h * 0.8;\n            }\n            w = w > this.w ? this.w : w;\n            h = h > this.h ? this.h : h;\n            if (this.fixed) {\n                h = w / this.fixedNumber[0] * this.fixedNumber[1];\n            }\n            // 如果比例之后 高度大于h\n            if (h > this.h) {\n                h = this.h;\n                w = h / this.fixedNumber[1] * this.fixedNumber[0];\n            }\n            this.changeCrop(w, h);\n        },\n        // 手动改变截图框大小函数\n        changeCrop(w, h) {\n            // 判断是否大于容器\n            this.cropW = w;\n            this.cropH = h;\n            // 居中走一走\n            this.cropOffsertX = (this.w - w) / 2;\n            this.cropOffsertY = (this.h - h) / 2;\n        },\n        // 重置函数， 恢复组件置初始状态\n        refresh() {\n            // console.log('refresh')\n            this.imgs = '';\n            this.scale = 1;\n            this.crop = false;\n            this.rotate = 0;\n            this.w = 0;\n            this.h = 0;\n            this.trueWidth = 0;\n            this.trueHeight = 0;\n            this.clearCrop();\n        },\n\n        // 向左边旋转\n        rotateLeft() {\n            this.rotate = this.rotate <= -3 ? 0 : this.rotate - 1;\n        },\n\n        // 向右边旋转\n        rotateRight() {\n            this.rotate = this.rotate >= 3 ? 0 : this.rotate + 1;\n        },\n\n        // 清除旋转\n        rotateClear() {\n            this.rotate = 0;\n        }\n    },\n    mounted() {\n        let that = this;\n        this.showPreview();\n        this.checkedImg();\n        var u = navigator.userAgent;\n        this.isIOS = !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/);\n        // 兼容blob\n        if (!HTMLCanvasElement.prototype.toBlob) {\n            Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n                value: function(callback, type, quality) {\n                    var binStr = atob(\n                            this.toDataURL(type, quality).split(',')[1]\n                        ),\n                        len = binStr.length,\n                        arr = new Uint8Array(len);\n                    for (var i = 0; i < len; i++) {\n                        arr[i] = binStr.charCodeAt(i);\n                    }\n                    callback(\n                        new Blob([arr], { type: that.type || 'image/png' })\n                    );\n                }\n            });\n        }\n    }\n};\n\n</script>\n<style>\n.vue-cropper {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    box-sizing: border-box;\n    user-select: none;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    direction: ltr;\n    touch-action: none;\n    background-color: #000;\n    /* background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC'); */\n}\n\n.cropper-box,\n.cropper-box-canvas,\n.cropper-drag-box,\n.cropper-crop-box,\n.cropper-face {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    user-select: none;\n}\n\n.cropper-box-canvas img {\n    position: relative;\n    user-select: none;\n    transform: none;\n    max-width: none;\n    max-height: none;\n}\n\n.cropper-box {\n    overflow: hidden;\n}\n\n.cropper-move {\n    cursor: move;\n}\n\n.cropper-crop {\n    cursor: crosshair;\n}\n\n.cropper-modal {\n    background: rgba(0, 0, 0, 0.5);\n}\n\n.cropper-crop-box {\n    /*border: 2px solid #44a870;*/\n}\n\n.cropper-view-box {\n    display: block;\n    overflow: hidden;\n    width: 100%;\n    height: 100%;\n    outline: 1px solid #44a870;\n    outline-color: #44a870;\n    user-select: none;\n}\n\n.cropper-view-box img {\n    user-select: none;\n    max-width: none;\n    max-height: none;\n}\n\n.cropper-face {\n    top: 0;\n    left: 0;\n    background-color: #fff;\n    opacity: 0.1;\n}\n\n.crop-info {\n    position: absolute;\n    left: 0px;\n    min-width: 65px;\n    text-align: center;\n    color: white;\n    line-height: 20px;\n    background-color: rgba(0, 0, 0, 0.8);\n    font-size: 12px;\n}\n\n.crop-line {\n    position: absolute;\n    display: block;\n    width: 100%;\n    height: 100%;\n    opacity: .1;\n}\n\n.line-w {\n    top: -3px;\n    left: 0;\n    height: 5px;\n    cursor: n-resize;\n}\n\n.line-a {\n    top: 0;\n    left: -3px;\n    width: 5px;\n    cursor: w-resize;\n}\n\n.line-s {\n    bottom: -3px;\n    left: 0;\n    height: 5px;\n    cursor: s-resize;\n}\n\n.line-d {\n    top: 0;\n    right: -3px;\n    width: 5px;\n    cursor: e-resize;\n}\n\n.crop-point {\n    position: absolute;\n    width: 8px;\n    height: 8px;\n    opacity: .75;\n    background-color: #44a870;\n    border-radius: 100%;\n}\n\n.point1 {\n    top: -4px;\n    left: -4px;\n    cursor: nw-resize;\n}\n\n.point2 {\n    top: -5px;\n    left: 50%;\n    margin-left: -3px;\n    cursor: n-resize;\n}\n\n.point3 {\n    top: -4px;\n    right: -4px;\n    cursor: ne-resize;\n}\n\n.point4 {\n    top: 50%;\n    left: -4px;\n    margin-top: -3px;\n    cursor: w-resize;\n}\n\n.point5 {\n    top: 50%;\n    right: -4px;\n    margin-top: -3px;\n    cursor: w-resize;\n}\n\n.point6 {\n    bottom: -5px;\n    left: -4px;\n    cursor: sw-resize;\n}\n\n.point7 {\n    bottom: -5px;\n    left: 50%;\n    margin-left: -3px;\n    cursor: s-resize;\n}\n\n.point8 {\n    bottom: -5px;\n    right: -4px;\n    cursor: nw-resize;\n}\n\n@media screen and (max-width: 500px) {\n    .crop-point {\n        position: absolute;\n        width: 20px;\n        height: 20px;\n        opacity: .45;\n        background-color: #44a870;\n        border-radius: 100%;\n    }\n\n    .point1 {\n        top: -10px;\n        left: -10px;\n    }\n\n    .point2,\n    .point4,\n    .point5,\n    .point7 {\n        display: none;\n    }\n\n    .point3 {\n        top: -10px;\n        right: -10px;\n    }\n\n    .point4 {\n        top: 0;\n        left: 0;\n    }\n\n    .point6 {\n        bottom: -10px;\n        left: -10px;\n    }\n\n    .point8 {\n        bottom: -10px;\n        right: -10px;\n    }\n}\n\n</style>\n"]}]}